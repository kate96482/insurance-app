<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="icon" type="image/png" href="logo.png">
    <meta name="apple-mobile-web-app-title" content="小邦手">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MBTI 64型深度鑑定 - 小邦手</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary: #A29BFE;
            --secondary: #6C5CE7;
            --bg: #F8F9FA;
        }
        body { 
            font-family: "Microsoft JhengHei", sans-serif; 
            background-color: var(--bg); 
            margin: 0; padding: 15px; 
            display: flex; flex-direction: column; align-items: center;
            -webkit-tap-highlight-color: transparent;
        }
        
        .mbti-container { width: 100%; max-width: 500px; background: white; border-radius: 25px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); box-sizing: border-box; }
        
        /* 進度條樣式 */
        .progress-box { width: 100%; height: 6px; background: #eee; border-radius: 10px; margin: 15px 0; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); transition: 0.4s cubic-bezier(0.1, 0.7, 0.1, 1); }
        
        /* 選項按鈕樣式 */
        .options-container { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .opt-btn { 
            border: none; padding: 14px; border-radius: 50px; font-weight: bold; 
            cursor: pointer; transition: 0.2s; font-size: 0.95rem; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .opt-btn:active { transform: scale(0.96); opacity: 0.8; }
        .opt-agree-3 { background-color: #D1E9FF; color: #0056b3; }
        .opt-agree-2 { background-color: #E3F2FF; color: #0056b3; }
        .opt-agree-1 { background-color: #F0F8FF; color: #0056b3; }
        .opt-neutral { background-color: #F1F3F5; color: #888; }
        .opt-disagree-1 { background-color: #FFF0F3; color: #c9184a; }
        .opt-disagree-2 { background-color: #FFDDE4; color: #c9184a; }
        .opt-disagree-3 { background-color: #FFCAD4; color: #c9184a; }

        /* 直接分析區域 */
        .direct-box { margin-top: 25px; padding-top: 20px; border-top: 1px dashed #eee; text-align: center; }
        .type-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 15px; }
        .type-chip { 
            padding: 10px 5px; background: #f8f9fa; border-radius: 10px; font-size: 0.75rem; 
            cursor: pointer; border: 1px solid #eee; font-weight: bold; color: #555;
            transition: 0.2s;
        }
        .type-chip:active { background: var(--primary); color: white; border-color: var(--primary); }

        /* 結果圖卡設計 */
        #capture-area { 
            background: linear-gradient(135deg, #6C5CE7 0%, #A29BFE 100%);
            padding: 35px 20px; text-align: center; border-radius: 20px; 
        }
        .result-card-design { 
            background: white; padding: 30px 20px; 
            border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        #res-code { font-size: 3.2rem; color: var(--secondary); margin: 5px 0; font-weight: 900; letter-spacing: 1px; }
        .subtype-label { 
            display: inline-block; background: #FFF0F3; color: #c9184a; 
            padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; 
            font-weight: bold; margin-bottom: 15px; 
        }
        #res-desc { text-align: justify; line-height: 1.6; color: #444; font-size: 0.95rem; }
        
        .analysis-box { 
            background: #F8F9FA; border-radius: 12px; padding: 15px; 
            margin-top: 15px; text-align: left; border-left: 4px solid var(--secondary);
        }
        .analysis-title { font-size: 0.85rem; font-weight: bold; color: var(--secondary); margin-bottom: 5px; }

        #final-image-wrapper img { width: 100%; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); margin-top: 10px; }
        
        .btn { padding: 12px 25px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--secondary); color: white; }
        .btn-secondary { background: #eee; color: #666; }

        #capture-area * { word-break: break-all; }
    </style>
</head>
<body>

<div id="mbti-app" class="mbti-container">
    <div id="quiz-intro">
        <div style="text-align: center; margin-bottom: 20px;">
            <i class="fa-solid fa-wand-magic-sparkles" style="font-size: 4rem; color: var(--primary); margin-bottom: 15px;"></i>
            <h2 style="color:var(--secondary);">MBTI 64型深度鑑定</h2>
            <p style="color: #666; line-height: 1.6;">結合核心人格與能量壓力軸<br>發現您在 64 種亞型中的真實定位</p>
        </div>
        <div style="text-align: center; margin: 30px 0;">
            <button class="btn btn-primary" style="width: 80%; padding: 15px; font-size: 1.1rem;" onclick="startQuiz()">開始深度測驗 (60題)</button>
        </div>

        <div class="direct-box">
            <div style="font-size: 0.85rem; color: #999;">或點選已知型號直接分析</div>
            <div class="type-grid" id="type-grid"></div>
            <div style="margin-top:15px; display:flex; gap:20px; justify-content:center;">
                <label style="font-size:0.9rem; color:#555; cursor:pointer;"><input type="radio" name="suffix" value="A" checked> 穩健型(-A)</label>
                <label style="font-size:0.9rem; color:#555; cursor:pointer;"><input type="radio" name="suffix" value="T"> 動盪型(-T)</label>
            </div>
        </div>
    </div>

    <div id="quiz-content" style="display:none;">
        <div class="progress-box"><div id="progress-bar"></div></div>
        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #aaa; margin-bottom: 20px;">
            <span onclick="location.reload()" style="cursor:pointer;"><i class="fa-solid fa-xmark"></i> 放棄</span>
            <span id="progress-text">0 / 60</span>
        </div>
        <div style="min-height: 100px; display: flex; align-items: center; justify-content: center;">
            <h3 id="q-text" style="text-align: center; margin: 0; color: #333; line-height: 1.4;"></h3>
        </div>
        <div class="options-container">
            <button class="opt-btn opt-agree-3" onclick="handleAnswer(3)">非常同意</button>
            <button class="opt-btn opt-agree-2" onclick="handleAnswer(2)">同意</button>
            <button class="opt-btn opt-agree-1" onclick="handleAnswer(1)">稍微同意</button>
            <button class="opt-btn opt-neutral" onclick="handleAnswer(0)">中立</button>
            <button class="opt-btn opt-disagree-1" onclick="handleAnswer(-1)">稍微不同意</button>
            <button class="opt-btn opt-disagree-2" onclick="handleAnswer(-2)">不同意</button>
            <button class="opt-btn opt-disagree-3" onclick="handleAnswer(-3)">非常不同意</button>
        </div>
        <div style="text-align:center; margin-top:20px;">
            <button id="prev-btn" onclick="prevQuestion()" style="display:none; color: #aaa; background: none; border: none; cursor: pointer;">
                <i class="fa-solid fa-arrow-left"></i> 上一題
            </button>
        </div>
    </div>

    <div id="result-page" style="display:none;">
        <div id="capture-area">
            <div class="result-card-design">
                <div style="color:var(--secondary); font-weight:bold; font-size:0.75rem; margin-bottom:5px; letter-spacing:2px;">MBTI 64-TYPE REPORT</div>
                <h1 id="res-code">----</h1>
                <div class="subtype-label" id="res-subtype">子型鑑定中...</div>
                <div id="res-desc"></div>
                
                <div class="analysis-box">
                    <div class="analysis-title"><i class="fa-solid fa-bolt"></i> 亞型壓力應對 (Subtype Focus)</div>
                    <div id="res-stress" style="font-size: 0.85rem; color: #666; line-height: 1.5;"></div>
                </div>
                
                <div style="margin-top:20px; font-size: 10px; color:#ccc;">小邦手心理測驗 | 2026 數位鑑定版</div>
            </div>
        </div>
        <div id="final-image-wrapper">
            <div style="text-align: center; padding: 40px; color: #aaa;">
                <i class="fa-solid fa-circle-notch fa-spin"></i> 正在生成您的 64 型專屬名片...
            </div>
        </div>
        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
            <button class="btn btn-secondary" onclick="location.reload()">重新測驗</button>
            <button class="btn btn-primary" onclick="location.reload()">回首頁</button>
        </div>
    </div>
</div>

<script>
// 完整 60 題庫
const mbtiQuestions = [
    { text: "在社交聚會中，你通常是主動找人交談的那一位。", dim: "EI", dir: 1 },
    { text: "即使是在熱鬧的場合待上一整天，你依然感到精力充沛。", dim: "EI", dir: 1 },
    { text: "你更喜歡在安靜、私密的環境下工作，而不是開放式的辦公室。", dim: "EI", dir: -1 },
    { text: "當你需要放鬆時，與朋友聚會通常比獨自看書更有效。", dim: "EI", dir: 1 },
    { text: "你喜歡成為群眾矚目的焦點。", dim: "EI", dir: 1 },
    { text: "在打電話之前，你通常會先在腦中演練一遍要說的話。", dim: "EI", dir: -1 },
    { text: "參加社交活動後，你通常會感到精疲力竭，需要時間獨處。", dim: "EI", dir: -1 },
    { text: "你在團體討論中往往能很快地發表意見。", dim: "EI", dir: 1 },
    { text: "你傾向於先行動再思考，而不是先思考再行動。", dim: "EI", dir: 1 },
    { text: "對你來說，認識新朋友是一件輕鬆且令人興奮的事。", dim: "EI", dir: 1 },
    { text: "你不介意成為一個大型項目的領導者或發言人。", dim: "EI", dir: 1 },
    { text: "你通常更喜歡深層的一對一對話，而不是多人的小型寒暄。", dim: "EI", dir: -1 },
    { text: "你更專注於當下的現實情況，而非未來的可能性。", dim: "SN", dir: 1 },
    { text: "你喜歡研究抽象的概念和理論。", dim: "SN", dir: -1 },
    { text: "處理具體的數據和事實比思考未來的藍圖更讓你感到踏實。", dim: "SN", dir: 1 },
    { text: "你經常陷入沉思，以至於忽視了周圍發生的事情。", dim: "SN", dir: -1 },
    { text: "在執行任務時，你偏好遵循經過驗證的傳統方法。", dim: "SN", dir: 1 },
    { text: "你經常會去思考「如果...會怎樣」這類的假設性問題。", dim: "SN", dir: -1 },
    { text: "你認為具備常識比擁有過人的想像力更重要。", dim: "SN", dir: 1 },
    { text: "你更喜歡閱讀文學名著或科幻作品，而不是寫實的新聞報導。", dim: "SN", dir: -1 },
    { text: "對你來說，事情的細節往往比整體的輪廓更吸引你。", dim: "SN", dir: 1 },
    { text: "你擅長在看似無關的事物之間發現隱藏的聯結。", dim: "SN", dir: -1 },
    { text: "你偏向於務實地解決問題，而不是尋求創新的突破。", dim: "SN", dir: 1 },
    { text: "你經常會夢想著未來各種可能發生的驚人改變。", dim: "SN", dir: -1 },
    { text: "在做決定時，你認為邏輯分析比情感考量更重要。", dim: "TF", dir: 1 },
    { text: "你非常在意他人的感受，儘管有時這會影響你的判斷。", dim: "TF", dir: -1 },
    { text: "在爭論中，你更在乎誰才是事實上的正確，而不是誰會受傷。", dim: "TF", dir: 1 },
    { text: "你通常會為了維持團體的和諧而做出讓步。", dim: "TF", dir: -1 },
    { text: "你認為一個好的決策應該是客觀且不偏不倚的。", dim: "TF", dir: 1 },
    { text: "你很容易被感人的電影或故事觸動而流淚。", dim: "TF", dir: -1 },
    { text: "朋友找你傾訴時，你通常會先提供解決建議，而不是情感安慰。", dim: "TF", dir: 1 },
    { text: "你認為追求真理比保持圓滑的人際關係更為重要。", dim: "TF", dir: 1 },
    { text: "你在做重要決定前，會反覆思考這對其他人會產生什麼影響。", dim: "TF", dir: -1 },
    { text: "你通常被認為是一個冷靜、理性甚至有點冷酷的人。", dim: "TF", dir: 1 },
    { text: "你很難拒絕他人的請求，因為你害怕讓對方失望。", dim: "TF", dir: -1 },
    { text: "你認為遵守規則與公平原則，比給予個案特殊同情更重要。", dim: "TF", dir: 1 },
    { text: "在旅行前，你通常會制定詳細的行程計畫。", dim: "JP", dir: 1 },
    { text: "你喜歡保留靈活的彈性，不喜歡把時間表排得太死。", dim: "JP", dir: -1 },
    { text: "看到東西亂放或環境混亂時，你會感到焦慮。", dim: "JP", dir: 1 },
    { text: "你經常等到最後一刻截止日期快到了，才開始全力衝刺。", dim: "JP", dir: -1 },
    { text: "你的工作空間與電腦檔案通常整齊劃一、井然有序。", dim: "JP", dir: 1 },
    { text: "你更喜歡隨性而至的冒險，而不是按部就班的安排。", dim: "JP", dir: -1 },
    { text: "你傾向於在開始一項新任務前，先把所有的步驟都想好。", dim: "JP", dir: 1 },
    { text: "你認為「計畫趕不上變化」，所以沒必要設定太嚴密的目標。", dim: "JP", dir: -1 },
    { text: "完成一件清單上的任務會讓你感到巨大的滿足感。", dim: "JP", dir: 1 },
    { text: "你經常在不同的任務之間跳來跳去，而不是專注完成一項再做下一項。", dim: "JP", dir: -1 },
    { text: "你不喜歡驚喜，更希望事情按照預期的方向發展。", dim: "JP", dir: 1 },
    { text: "你認為生活應該是充滿自發性的，而不是被各種規矩束縛。", dim: "JP", dir: -1 },
    { text: "面對突發的巨大壓力，你通常能保持冷靜且情緒穩定。", dim: "AT", dir: 1 },
    { text: "你經常會擔心自己做錯了決定或說錯了話。", dim: "AT", dir: -1 },
    { text: "你對自己的能力非常有信心，不太需要他人的認同。", dim: "AT", dir: 1 },
    { text: "你是一個完美主義者，常為了細小的瑕疵而感到焦慮。", dim: "AT", dir: -1 },
    { text: "即使遇到了挫折，你也能很快地重新站起來。", dim: "AT", dir: 1 },
    { text: "你非常在意他人對你的評價和看法。", dim: "AT", dir: -1 },
    { text: "你很少會對過去發生的事情感到遺憾或後悔。", dim: "AT", dir: 1 },
    { text: "你經常覺得生活壓力讓你喘不過氣。", dim: "AT", dir: -1 },
    { text: "在社交場合，你通常感到很自在，不會覺得尷尬。", dim: "AT", dir: 1 },
    { text: "你經常反覆思考剛剛與他人的對話，擔心自己表現不佳。", dim: "AT", dir: -1 },
    { text: "你認為自己是一個情緒非常穩定的人。", dim: "AT", dir: 1 },
    { text: "你很容易因為生活中的小事而感到焦慮或挫折。", dim: "AT", dir: -1 }
];

const personalityData = {
    "INTJ": { name: "建築師", desc: "追求完美的策略家，擁有極強的獨立思考能力與長遠願景。" },
    "INTP": { name: "邏輯學家", desc: "腦袋裡裝滿理論的發明家，比起現實，更愛探索知識的本質。" },
    "ENTJ": { name: "指揮官", desc: "天生的領導者，具備強大意志，能迅速將複雜願景轉化為行動。" },
    "ENTP": { name: "辯論家", desc: "思維活躍的挑戰者，喜歡在智力博弈中打破傳統規則。" },
    "INFJ": { name: "提倡者", desc: "深沉的理想主義者，對人性有極深洞察，渴望改變世界的底層邏輯。" },
    "INFP": { name: "調解者", desc: "靈魂的藝術家，對內在價值極度忠誠，充滿詩意與同理心。" },
    "ENFJ": { name: "主人公", desc: "溫暖且具感染力的領袖，善於引領眾人走向和諧與進步。" },
    "ENFP": { name: "競選者", desc: "自由奔放的追夢人，在生活的每一個角落尋找靈感與火花。" },
    "ISTJ": { name: "物流師", desc: "社會的守護者，重視傳統、秩序與事實，極度可靠且務實。" },
    "ISFJ": { name: "守護者", desc: "低調的奉獻者，默默照顧他人需求，維持環境的和諧穩定。" },
    "ESTJ": { name: "總管", desc: "秩序的執行者，追求效率與具體成果，是團隊中最強的執行力。" },
    "ESFJ": { name: "執政官", desc: "社交的樞紐，熱衷於建立連結，對群體需求極為敏銳且友善。" },
    "ISTP": { name: "鑑賞家", desc: "冷靜的工匠，動手能力極強，擅長用最精簡的方法解決問題。" },
    "ISFP": { name: "藝術家", desc: "活在當下的美感追求者，用細膩且溫和的方式探索感官世界。" },
    "ESTP": { name: "企業家", desc: "行動派冒險家，活在當下，能精準捕捉機會並迅速反應。" },
    "ESFP": { name: "表演者", desc: "生命的演出者，能點燃現場氣氛，讓每一刻都充滿樂趣。" }
};

let currentIdx = 0;
let userScores = { EI: 0, SN: 0, TF: 0, JP: 0, AT: 0 };
let scoreHistory = [];

// 初始化選單
const grid = document.getElementById('type-grid');
Object.keys(personalityData).forEach(code => {
    const chip = document.createElement('div');
    chip.className = 'type-chip';
    chip.innerText = code;
    chip.onclick = () => {
        const suffix = document.querySelector('input[name="suffix"]:checked').value;
        showResultPage(`${code}-${suffix}`);
    };
    grid.appendChild(chip);
});

function startQuiz() {
    document.getElementById('quiz-intro').style.display = 'none';
    document.getElementById('quiz-content').style.display = 'block';
    renderQuestion();
}

function renderQuestion() {
    window.scrollTo(0,0);
    const q = mbtiQuestions[currentIdx];
    document.getElementById('q-text').innerText = q.text;
    document.getElementById('progress-text').innerText = `${currentIdx + 1} / ${mbtiQuestions.length}`;
    document.getElementById('progress-bar').style.width = ((currentIdx + 1) / mbtiQuestions.length * 100) + "%";
    document.getElementById('prev-btn').style.display = currentIdx > 0 ? "inline-block" : "none";
}

function handleAnswer(val) {
    const q = mbtiQuestions[currentIdx];
    const pts = val * q.dir;
    userScores[q.dim] += pts;
    scoreHistory.push({ dim: q.dim, pts: pts });
    
    currentIdx++;
    if (currentIdx < mbtiQuestions.length) {
        renderQuestion();
    } else {
        const res = (userScores.EI >= 0 ? "E" : "I") + (userScores.SN >= 0 ? "S" : "N") + 
                    (userScores.TF >= 0 ? "T" : "F") + (userScores.JP >= 0 ? "J" : "P") +
                    "-" + (userScores.AT >= 0 ? "A" : "T");
        showResultPage(res);
    }
}

function prevQuestion() {
    if (currentIdx > 0) {
        currentIdx--;
        const last = scoreHistory.pop();
        userScores[last.dim] -= last.pts;
        renderQuestion();
    }
}

function showResultPage(code) {
    document.getElementById('quiz-intro').style.display = 'none';
    document.getElementById('quiz-content').style.display = 'none';
    document.getElementById('result-page').style.display = 'block';

    const base = code.split('-')[0];
    const isE = code.startsWith('E');
    const isA = code.endsWith('A');
    
    // 64亞型邏輯
    let subTitle = "";
    let stressDesc = "";
    
    if (isE && isA) {
        subTitle = "開拓亞型 (The Pioneer)";
        stressDesc = "在壓力下表現出極強的侵略性與行動力，傾向於透過「控制外部環境」來解決焦慮，是天生的變革引領者。";
    } else if (isE && !isA) {
        subTitle = "感應亞型 (The Reactor)";
        stressDesc = "高度關注外界反饋，雖然充滿活力但內心起伏劇烈，常在社交互動中尋求自我價值的確認與情緒緩解。";
    } else if (!isE && isA) {
        subTitle = "防禦亞型 (The Defender)";
        stressDesc = "內在極度穩定，不輕易受外界干擾。在危機中表現冷漠且高效，能獨自消化大量負面訊息而不崩潰。";
    } else {
        subTitle = "深思亞型 (The Observer)";
        stressDesc = "高敏感且追求完美，壓力下傾向於退縮到精神世界進行過度分析，對細節有近乎強迫的掌控欲。";
    }

    document.getElementById('res-code').innerText = code;
    document.getElementById('res-subtype').innerText = subTitle;
    document.getElementById('res-desc').innerText = personalityData[base].desc;
    document.getElementById('res-stress').innerText = stressDesc;

    setTimeout(() => {
        html2canvas(document.getElementById('capture-area'), { scale: 2 }).then(canvas => {
            const wrapper = document.getElementById('final-image-wrapper');
            wrapper.innerHTML = "";
            const img = document.createElement('img');
            img.src = canvas.toDataURL();
            wrapper.appendChild(img);
            document.getElementById('capture-area').style.display = "none";
        });
    }, 1000);
}
</script>
</body>
</html>
