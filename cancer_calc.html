<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>防癌試算 - 小邦手</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #005a92; --bg: #f4f7f9; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); padding: 8px; }
        .back-home { display: inline-flex; align-items: center; gap: 5px; color: var(--primary); font-weight: bold; font-size: 0.9rem; margin-bottom: 10px; padding: 8px 15px; border-radius: 20px; background: white; box-shadow: 0 1px 4px rgba(0,0,0,0.1); cursor: pointer; }
        .container { max-width: 850px; margin: auto; background: white; padding: 12px; border-radius: 12px; box-shadow: 0 2px 15px rgba(0,0,0,0.1); }
        h2 { color: var(--primary); text-align: center; margin: 5px 0 12px; font-size: 1.15rem; }
        .control-group { background: #fff; border: 2px solid var(--primary); padding: 10px; border-radius: 10px; margin-bottom: 12px; }
        .gender-selector { display: flex; gap: 8px; margin-bottom: 10px; }
        .gender-btn { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: #f8fafc; cursor: pointer; font-weight: bold; }
        .gender-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .age-control { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; }
        #ageInput { width: 50px; padding: 4px; text-align: center; border: 1.5px solid var(--primary); border-radius: 4px; font-weight: bold; }
        #ageSlider { flex: 1; accent-color: var(--primary); }
        .chart-section { display: flex; gap: 6px; margin-bottom: 12px; }
        .chart-card { flex: 1; border: 1px solid #e2e8f0; border-radius: 10px; padding: 5px 0; background: #fff; min-width: 0; display: flex; flex-direction: column; height: 220px; }
        .chart-title { font-size: 0.8rem; font-weight: bold; color: var(--primary); text-align: center; margin-bottom: 2px; }
        .chart-wrapper { flex: 1; position: relative; width: 100%; height: 100%; }
        .v3-visual-stats { display: flex; gap: 6px; margin-bottom: 12px; }
        .v3-clock-box { flex: 0 0 38%; background: #1e293b; border-radius: 10px; padding: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #00ff41; box-shadow: inset 0 0 8px rgba(0,0,0,0.5); }
        .v3-clock-time { font-family: monospace; font-size: 1.5rem; font-weight: bold; }
        .v3-clock-tag { margin-top: 5px; background: #d9534f; color: white; font-size: 0.55rem; padding: 2px 4px; border-radius: 3px; }
        .v3-trend-box { flex: 1; min-width: 0; background: #fff; border: 1px solid #e2e8f0; border-radius: 10px; padding: 5px; display: flex; flex-direction: column; }
        .v3-trend-title { font-size: 0.75rem; font-weight: bold; color: var(--primary); text-align: left; margin: 2px 0 5px 5px; }
        .v3-trend-canvas { flex: 1; width: 100%; height: 90px; position: relative; }
        .result-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-bottom: 15px; }
        .result-item { background: #fff; border: 1px solid #cbd5e1; padding: 6px 2px; border-radius: 8px; text-align: center; font-size: 0.7rem; }
        .result-item .value { font-size: 0.85rem; color: #d9534f; font-weight: 800; }
        .plan-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        .plan-card { background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 6px 2px; text-align: center; cursor: pointer; }
        .plan-card.active { border: 2px solid var(--primary); background: #f0f9ff; }
        .plan-card span { display: block; font-size: 0.6rem; font-weight: bold; }
        #detail-view { margin-top: 12px; padding: 10px; border-left: 4px solid var(--primary); background: #f8fafc; display: none; font-size: 0.85rem; }
        @media (max-width: 600px) { .chart-card { height: 160px; } .result-grid { grid-template-columns: repeat(2, 1fr); } .plan-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
<div class="container">
    <h2>防癌無憂即時試算</h2>
    <div class="control-group">
        <div class="gender-selector">
            <button class="gender-btn active" onclick="setGender('male', this)">男性</button>
            <button class="gender-btn" onclick="setGender('female', this)">女性</button>
        </div>
        <div class="age-control">
            <span>年齡</span>
            <input type="number" id="ageInput" value="30" min="30" max="64" oninput="updateAge('input')">
            <input type="range" id="ageSlider" min="30" max="64" value="30" oninput="updateAge('slider')">
        </div>
    </div>

    <div class="chart-section">
        <div class="chart-card">
            <div class="chart-title">存活率對比</div>
            <div class="chart-wrapper"><canvas id="survivalChart"></canvas></div>
        </div>
        <div class="chart-card">
            <div class="chart-title" id="cancerTitle">男性前十大癌症</div>
            <div class="chart-wrapper"><canvas id="cancerChart"></canvas></div>
        </div>
    </div>

    <div class="v3-visual-stats">
        <div class="v3-clock-box">
            <div style="font-size:0.55rem; color:#94a3b8;">CANCER CLOCK</div>
            <div class="v3-clock-time">04:10</div>
            <div class="v3-clock-tag">每 4 分 10 秒增 1 人</div>
        </div>
        <div class="v3-trend-box">
            <div class="v3-trend-title">罹癌年齡趨勢</div>
            <div class="v3-trend-canvas"><canvas id="ageDistChart"></canvas></div>
        </div>
    </div>

    <div class="result-grid" id="resGrid">
        </div>

    <div style="font-size: 0.8rem; font-weight: bold; margin-bottom: 8px;">檢測方案每年8選1</div>
    <div class="plan-grid">
        <div class="plan-card" onclick="selectPlan(0, this)"><span>CTC 循環</span></div>
        <div class="plan-card" onclick="selectPlan(1, this)"><span>肝甲狀腺</span></div>
        <div class="plan-card" onclick="selectPlan(2, this)"><span>男性基因</span></div>
        <div class="plan-card" onclick="selectPlan(3, this)"><span>女性基因</span></div>
        <div class="plan-card" onclick="selectPlan(4, this)"><span>特殊癌</span></div>
        <div class="plan-card" onclick="selectPlan(5, this)"><span>隱匿危機</span></div>
        <div class="plan-card" onclick="selectPlan(6, this)"><span>癌心血管</span></div>
        <div class="plan-card" onclick="selectPlan(7, this)"><span>腦部神經</span></div>
    </div>
    <div id="detail-view">
        <div id="pTitle" style="font-weight:bold; color:var(--primary);"></div>
        <div id="pDesc" style="margin:5px 0;"></div>
        <div id="pMethod" style="color:#d9534f; font-weight:bold;"></div>
    </div>
</div>

<script>
    let gender = 'male', sChart, cChart, aChart;
    Chart.register(ChartDataLabels);

    const plans = [
        { t: "CTC 循環腫瘤細胞檢測", d: "偵測血液中微量循環腫瘤細胞。", m: "$15,000 ~ $45,000" },
        { t: "全方位肝及甲狀腺檢測", d: "深度評估肝炎及甲狀腺結節。", m: "$17,000 ~ $20,000" },
        { t: "男性十大癌症基因套組", d: "針對男性好發癌症基因篩查。", m: "$25,800" },
        { t: "女性十大癌症基因套組", d: "專為乳癌、卵巢癌設計。", m: "$25,800" },
        { t: "特殊癌症早期警示基因", d: "涵蓋胰臟癌、膽囊癌等。", m: "$15,800" },
        { t: "隱匿危機癌症風險預測", d: "預測甲狀腺癌、膀瘡癌等。", m: "$15,800" },
        { t: "綜合血癌與心血管基因", d: "檢測血液腫瘤與高風險基因。", m: "$15,800" },
        { t: "腦癌與神經功能障礙套組", d: "評估腦部腫瘤及遺傳風險。", m: "$15,800" }
    ];

    function updateCharts() {
        const cData = gender === 'male' ? [15, 14, 12, 10, 9, 8, 7, 6, 5, 4] : [25, 12, 11, 10, 8, 7, 6, 5, 4, 3];
        cChart.data.datasets[0].data = cData;
        cChart.update();

        // 核心修改：分色漸層陣列 (左淺右深)
        const maleGradients = ['#bbdefb', '#64b5f6', '#2196f3', '#1976d2', '#0d47a1'];
        const femaleGradients = ['#f8bbd0', '#f06292', '#e91e63', '#c2185b', '#880e4f'];
        
        aChart.data.datasets[0].backgroundColor = (gender === 'male' ? maleGradients : femaleGradients);
        aChart.update();
    }

    // 初始化與其他邏輯省略... (保持您原本的計算邏輯)
    window.onload = () => {
        // 長條圖配置優化
        aChart = new Chart(document.getElementById('ageDistChart'), {
            type: 'bar',
            data: { 
                labels: ['0-19', '20-39', '40-59', '60-79', '80+'], 
                datasets: [{ data: [5, 15, 35, 30, 10], borderRadius: 4 }] 
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                layout: { padding: { top: 22 } },
                scales: { 
                    y: { display: false, grace: '15%' },
                    x: { grid: { display: false }, ticks: { font: { size: 9 } } } 
                },
                plugins: { 
                    legend: { display: false }, 
                    datalabels: { anchor: 'end', align: 'top', font: { size: 10, weight: 'bold' }, formatter: v => v + '%' } 
                }
            }
        });
        // 呼叫其他圖表初始化...
        setGender('male', document.querySelector('.gender-btn'));
    };

    function setGender(g, btn) {
        gender = g;
        document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('cancerTitle').innerText = (g === 'male' ? '男性' : '女性') + '前十大癌症';
        updateCharts();
        render(); // 執行您的費用計算
    }

    function render() {
        const age = parseInt(document.getElementById('ageInput').value);
        // 此處對應您的原始費用計算邏輯並更新 DOM...
        const resGrid = document.getElementById('resGrid');
        resGrid.innerHTML = `
            <div class="result-item">目前年齡<br><span class="value">${age}</span></div>
            <div class="result-item">首年費用<br><span class="value">$8,464</span></div>
            <div class="result-item">續年費用<br><span class="value">$8,563</span></div>
        `;
    }
    
    function updateAge(t) {
        const i = document.getElementById('ageInput'), s = document.getElementById('ageSlider');
        if(t === 'input') s.value = i.value; else i.value = s.value;
        render();
    }
</script>
</body>
</html>
