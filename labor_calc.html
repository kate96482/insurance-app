<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€€ä¼‘é‡‘ç¼ºå£å…¨è§£æ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #DE6262; --secondary: #FFB88C; --text: #4A3728; --bg: #F0EDE9; --success: #2F855A; }
        body { font-family: "PingFang TC", sans-serif; background: var(--bg); margin: 0; padding: 15px; color: var(--text); }
        .container { max-width: 450px; margin: auto; padding-top: 40px; }
        
        /* å·¦ä¸Šè§’è¿”å› */
        .header-nav { position: absolute; top: 15px; left: 15px; }
        .back-home { text-decoration: none; color: var(--primary); font-weight: bold; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; }

        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        h2 { color: var(--primary); margin-top: 0; font-size: 1.4rem; text-align: center; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; color: var(--primary); }
        input, select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #E8E2D9; box-sizing: border-box; font-size: 1rem; outline: none; }
        .hint { font-size: 0.75rem; color: #888; margin-top: 3px; }
        .btn { width: 100%; padding: 15px; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top: 10px; }
        
        .text-results { display: none; }

        #result { display: none; margin-top: 25px; }
        .canvas-container { margin-bottom: 20px; text-align: center; }
        #output-image { width: 100%; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .save-tip { font-size: 0.8rem; color: #888; margin-top: 8px; }

        .btn-advanced { background: linear-gradient(135deg, #2F855A, #48BB78); margin-top: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; color: white; padding: 15px; border-radius: 12px; font-weight: bold; }
    </style>
</head>
<body>

<div class="header-nav">
    <a href="index.html" class="back-home"><i class="fa-solid fa-house"></i> è¿”å›é¦–é </a>
</div>

<div class="container">
    <div class="card">
        <h2><i class="fa-solid fa-hourglass-half"></i> é€€ä¼‘é‡‘ç¼ºå£è§£æ</h2>
        
        <div class="input-group">
            <label>å‡ºç”Ÿå¹´ (æ°‘åœ‹)</label>
            <input type="number" id="birth-year" placeholder="ä¾‹å¦‚ï¼š75" value="75">
        </div>

        <div class="input-group">
            <label>æ°‘åœ‹ 97 å¹´å‰æ˜¯å¦æœ‰å‹ä¿å¹´è³‡ï¼Ÿ</label>
            <select id="has-old-years">
                <option value="yes">æ˜¯ (å…·å‚™ä¸€æ¬¡é ˜è³‡æ ¼)</option>
                <option value="no">å¦ (åƒ…èƒ½é¸æ“‡æœˆé ˜å¹´é‡‘)</option>
            </select>
        </div>

        <div class="input-group">
            <label>ç†æƒ³é€€ä¼‘æœˆé ˜é‡‘é¡ (å…ƒ)</label>
            <input type="number" id="dream-income" value="50000">
        </div>

        <div class="input-group">
            <label>é è¨ˆé€€ä¼‘å¹´é½¡</label>
            <select id="retire-age">
                <option value="55">55 æ­²</option>
                <option value="60">60 æ­²</option>
                <option value="65" selected>65 æ­²</option>
                <option value="70">70 æ­²</option>
            </select>
            <div class="hint" id="legal-age-hint">æ‚¨çš„æ³•å®šé€€ä¼‘å¹´é½¡ç‚ºï¼š-- æ­²</div>
        </div>

        <div class="input-group">
            <label>æœ€é«˜ 60 å€‹æœˆå¹³å‡æŠ•ä¿è–ªè³‡</label>
            <input type="number" id="avg-salary" value="45800">
            <div class="hint">ç›®å‰å‹ä¿æœ€é«˜ä¸Šé™ç‚º 45,800 å…ƒ</div>
        </div>

        <div class="input-group">
            <label>é€€ä¼‘æ™‚å‹ä¿ç¸½å¹´è³‡</label>
            <input type="number" id="years" value="35">
        </div>

        <button class="btn" onclick="calculateGap()">åˆ†æç¼ºå£èˆ‡ç›®æ¨™</button>

        <div id="result">
            <div class="canvas-container">
                <canvas id="resultCanvas" width="800" height="1450" style="display:none;"></canvas>
                <img id="output-image" alt="é€€ä¼‘ç¼ºå£åˆ†æåœ–">
                <div class="save-tip" id="save-tip"><i class="fa-regular fa-image"></i> é•·æŒ‰ä¸Šæ–¹åœ–ç‰‡å¯å„²å­˜çµæœ</div>
            </div>

            <div class="text-results">
                <span id="res-labor"></span>
                <span id="res-gap"></span>
                <span id="res-total-gap"></span>
                <span id="res-prepare-years"></span>
                <span id="res-yearly-target"></span>
            </div>

            <a href="javascript:void(0)" id="advanced-btn" class="btn-advanced" onclick="goToStep2()">
                é€²å…¥é€²éšæ–¹æ¡ˆå°ç…§ <i class="fa-solid fa-chevron-right"></i>
            </a>
        </div>
    </div>
</div>

<script>
    let calculatedLabor = 0;

    function getLegalRetireAge(birthYear) {
        if (birthYear <= 46) return 60;
        if (birthYear == 47) return 61;
        if (birthYear == 48) return 62;
        if (birthYear == 49) return 63;
        if (birthYear == 50) return 64;
        return 65;
    }

    document.getElementById('birth-year').addEventListener('input', function() {
        const by = parseInt(this.value);
        if(by) document.getElementById('legal-age-hint').innerText = `æ‚¨çš„æ³•å®šé€€ä¼‘å¹´é½¡ç‚ºï¼š${getLegalRetireAge(by)} æ­²`;
    });

    function calculateGap() {
        const birthYear = parseInt(document.getElementById('birth-year').value);
        const hasOld = document.getElementById('has-old-years').value;
        const dreamIncome = parseFloat(document.getElementById('dream-income').value);
        const retireAge = parseInt(document.getElementById('retire-age').value);
        const avgSalary = parseFloat(document.getElementById('avg-salary').value);
        const years = parseInt(document.getElementById('years').value);
        const thisYear = 115; 
        const maxAge = 95;

        if(!birthYear) return alert("è«‹è¼¸å…¥å‡ºç”Ÿå¹´ä»½");

        const currentAge = thisYear - birthYear;
        const legalAge = getLegalRetireAge(birthYear);

        let laborA = (avgSalary * years * 0.00775) + 3000;
        let laborB = avgSalary * years * 0.0155;
        let bestBase = Math.max(laborA, laborB);
        
        let diff = retireAge - legalAge;
        if (diff > 5) diff = 5;
        if (diff < -5) diff = -5;
        const ratio = 1 + (diff * 0.04);
        calculatedLabor = Math.round(bestBase * ratio);

        let onceAmount = 0;
        if (hasOld === 'yes') {
            let baseCount = years <= 15 ? years : 15 + (years - 15) * 2;
            if (baseCount > 45) baseCount = 45;
            onceAmount = baseCount * avgSalary;
        }

        const monthlyGap = Math.max(0, dreamIncome - calculatedLabor);
        const retirePeriod = maxAge - retireAge;
        const totalGap = monthlyGap * 12 * retirePeriod;
        const prepareYears = Math.max(1, retireAge - currentAge);
        const yearlyTarget = Math.round(totalGap / prepareYears);

        document.getElementById('result').style.display = 'block';

        drawResultImage({
            birthYear, years, avgSalary, retireAge, legalAge, ratio,
            laborA: Math.round(laborA * ratio),
            laborB: Math.round(laborB * ratio),
            finalLabor: calculatedLabor,
            onceAmount: onceAmount,
            gap: monthlyGap,
            total: totalGap,
            prepare: prepareYears,
            yearly: yearlyTarget,
            monthly: Math.round(yearlyTarget / 12),
            hasOld: hasOld
        });
    }

    function drawResultImage(d) {
        const canvas = document.getElementById('resultCanvas');
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = '#DE6262';
        ctx.fillRect(0, 0, canvas.width, 140);
        ctx.fillStyle = '#FFFFFF';
        ctx.font = 'bold 44px "PingFang TC"';
        ctx.textAlign = 'center';
        ctx.fillText('é€€ä¼‘é‡‘ç¼ºå£è§£æå ±å‘Š', canvas.width / 2, 85);

        ctx.textAlign = 'left';
        ctx.font = '28px "PingFang TC"';

        let y = 200;
        ctx.fillStyle = '#DE6262';
        ctx.fillText('ä¸€ã€å‹ä¿å¹´é‡‘ä¼°ç®— (ç³»çµ±è‡ªå‹•æ“‡å„ª)', 60, y);
        
        y += 50;
        ctx.fillStyle = '#4A3728';
        ctx.font = '24px "PingFang TC"';
        ctx.fillText(`Aå¼ï¼š(${d.avgSalary} Ã— ${d.years}å¹´ Ã— 0.775%) + 3000 = $${d.laborA.toLocaleString()}`, 80, y);
        y += 40;
        ctx.fillText(`Bå¼ï¼š${d.avgSalary} Ã— ${d.years}å¹´ Ã— 1.55% = $${d.laborB.toLocaleString()}`, 80, y);
        y += 45;
        ctx.fillStyle = d.ratio >= 1 ? '#2F855A' : '#DE6262';
        ctx.fillText(`è«‹é ˜èª¿æ•´ï¼š${d.retireAge}æ­²é ˜å– (åŠ æ¸›é¡æ¯”ä¾‹: ${(d.ratio*100).toFixed(0)}%)`, 80, y);
        
        y += 60;
        ctx.fillStyle = '#FFF5F5';
        ctx.fillRect(60, y, 680, 80);
        ctx.fillStyle = '#DE6262';
        ctx.font = 'bold 32px "PingFang TC"';
        ctx.fillText(`é ä¼°æ¯æœˆé ˜å–ï¼š$ ${d.finalLabor.toLocaleString()}`, 100, y + 50);

        y += 150;
        if (d.hasOld === 'yes') {
            ctx.fillStyle = '#DE6262';
            ctx.font = 'bold 28px "PingFang TC"';
            ctx.fillText('äºŒã€ä¸€æ¬¡è«‹é ˜è©¦ç®—èˆ‡æ±ºç­–', 60, y);
            y += 50;
            ctx.fillStyle = '#4A3728';
            ctx.font = '24px "PingFang TC"';
            ctx.fillText(`ä¸€æ¬¡é ˜ç¸½é¡ï¼š$${d.onceAmount.toLocaleString()}`, 80, y);
            
            y += 45;
            ctx.fillStyle = '#2F855A';
            let breakEven = (d.onceAmount / (d.finalLabor * 12)).toFixed(1);
            ctx.font = 'bold 26px "PingFang TC"';
            ctx.fillText(`ğŸ’¡ æ±ºç­–åˆ†æï¼šæœˆé ˜æ»¿ ${breakEven} å¹´å³å›æœ¬`, 80, y);
            
            y += 35;
            ctx.font = 'italic 20px "PingFang TC"';
            ctx.fillStyle = '#888';
            ctx.fillText(`è¨ˆç®—å¼ï¼šä¸€æ¬¡é ˜ ${d.onceAmount.toLocaleString()} Ã· (æœˆé ˜ ${d.finalLabor.toLocaleString()} Ã— 12æœˆ) = ${breakEven}å¹´`, 100, y);
        } else {
            ctx.fillStyle = '#888';
            ctx.fillText('äºŒã€ä¸€æ¬¡è«‹é ˜è©¦ç®— (ä¸å…·å‚™è³‡æ ¼)', 60, y);
        }

        y += 140;
        ctx.fillStyle = '#DE6262';
        ctx.font = 'bold 28px "PingFang TC"';
        ctx.fillText('ä¸‰ã€é€€ä¼‘ç¼ºå£ç›®æ¨™ (è‡³95æ­²)', 60, y);
        
        y += 50;
        ctx.fillStyle = '#FFF5F5';
        ctx.fillRect(60, y, 680, 160);
        ctx.fillStyle = '#DE6262';
        ctx.font = 'bold 36px "PingFang TC"';
        ctx.textAlign = 'center';
        ctx.fillText('ç¸½è³‡é‡‘ç¼ºå£', canvas.width / 2, y + 60);
        ctx.font = 'bold 60px "PingFang TC"';
        ctx.fillText(`$ ${d.total.toLocaleString()}`, canvas.width / 2, y + 130);

        y += 230;
        ctx.textAlign = 'center';
        ctx.fillStyle = '#4A3728';
        ctx.font = '28px "PingFang TC"';
        ctx.fillText(`è·é›¢é€€ä¼‘å‰©é¤˜ï¼š${d.prepare} å¹´`, canvas.width / 2, y);

        y += 60;
        ctx.fillStyle = '#F0FFF4';
        ctx.fillRect(60, y, 680, 180);
        ctx.fillStyle = '#2F855A';
        ctx.font = 'bold 32px "PingFang TC"';
        ctx.fillText('æ¯å¹´éœ€é¡å¤–æº–å‚™', canvas.width / 2, y + 60);
        ctx.font = 'bold 55px "PingFang TC"';
        ctx.fillText(`$ ${d.yearly.toLocaleString()}`, canvas.width / 2, y + 135);
        
        y += 240;
        ctx.fillStyle = '#888';
        ctx.font = '20px "PingFang TC"';
        ctx.fillText('ç”±ã€Œå°é‚¦æ‰‹ã€è²¡å‹™åˆ†æå·¥å…·ç”¢å‡º', canvas.width / 2, y);

        const img = document.getElementById('output-image');
        img.src = canvas.toDataURL('image/png');
        img.style.display = 'block';
        document.getElementById('save-tip').style.display = 'block';
        img.scrollIntoView({ behavior: 'smooth' });
    }

    function goToStep2() {
        const birthYear = document.getElementById('birth-year').value;
        const currentAge = 115 - parseInt(birthYear);
        const dream = document.getElementById('dream-income').value;
        const retireAge = document.getElementById('retire-age').value;

        localStorage.setItem('retired_currentAge', currentAge);
        localStorage.setItem('retired_dreamIncome', dream);
        localStorage.setItem('retired_laborIncome', calculatedLabor);
        localStorage.setItem('retired_retireAge', retireAge);

        window.location.href = `step2.html`;
    }

    window.onload = () => document.getElementById('birth-year').dispatchEvent(new Event('input'));
</script>

</body>
</html>
