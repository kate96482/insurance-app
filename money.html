<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="icon" type="image/png" href="logo.png">
    <meta name="apple-mobile-web-app-title" content="å°é‚¦æ‰‹">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è²¸æ¬¾è©¦ç®—å…¨æ”»ç•¥ - å°é‚¦æ‰‹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bright-blue: #4CC9F0;
            --bright-pink: #F72585;
            --m-purple: #7209B7;
            --soft-mint: #B5EAD7;
            --soft-yellow: #FCF6BD;
            --text-dark: #2B2D42;
            --bg: #F8F9FA;
            --coffee: #4A3728;
            --oat: #E8E2D9;
        }

        body { 
            font-family: "Microsoft JhengHei", sans-serif; 
            background: var(--bg); 
            color: var(--text-dark); 
            margin: 0; padding: 10px;
            overflow-x: hidden;
        }

        .back-home {
            display: inline-flex; align-items: center; gap: 5px; 
            color: var(--m-purple); font-weight: bold; font-size: 0.9rem; margin-bottom: 10px;
            padding: 8px 15px; border-radius: 20px; background: white; 
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }
        .back-home:active { background: #eee; transform: scale(0.95); }

        .calc-container { 
            max-width: 600px; margin: auto; background: white; 
            padding: clamp(15px, 4vw, 25px); border-radius: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
        }

        h2 { color: var(--m-purple); text-align: center; margin: 5px 0 15px 0; font-size: 1.4rem; }

        .type-tabs { 
            display: flex; background: #F1F3F5; padding: 5px; border-radius: 15px; margin-bottom: 20px; 
        }
        .tab { 
            flex: 1; padding: 10px 2px; text-align: center; border-radius: 10px; 
            cursor: pointer; font-weight: 800; font-size: 0.85rem; transition: 0.3s; color: #ADB5BD;
        }
        .tab.active { background: #FFFFFF; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
        #tab-personal.active { color: var(--bright-pink); }
        #tab-mortgage.active { color: var(--bright-blue); }
        #tab-revolving.active { color: var(--m-purple); }

        .amt-section { 
            background: var(--soft-yellow); padding: 20px; border-radius: 20px; 
            margin-bottom: 20px; border: 1px solid #EEE;
        }
        .amt-label-row { display: flex; justify-content: space-between; align-items: center; }
        .amt-input-big { 
            width: 120px; padding: 5px; font-size: 1.5rem; font-weight: 900; 
            border: 2px solid var(--bright-blue); border-radius: 12px; text-align: center; color: var(--bright-blue);
            background: white;
        }

        .input-row { 
            margin-bottom: 12px; padding: 12px; background: #F8F9FA; border-radius: 15px; 
        }
        .val-display { color: var(--bright-pink); font-weight: 800; }

        input[type=range] { width: 100%; height: 8px; appearance: none; background: #DEE2E6; border-radius: 10px; margin-top: 15px; }
        input[type=range]::-webkit-slider-thumb { appearance: none; height: 20px; width: 20px; background: #FFF; border: 3px solid var(--bright-blue); border-radius: 50%; }

        .rate-config { background: var(--soft-mint); padding: 15px; border-radius: 15px; font-size: 0.9rem; }
        .step-row { display: flex; align-items: center; gap: 5px; margin-bottom: 8px; flex-wrap: wrap; }
        .step-row input { width: 50px; text-align: center; border-radius: 5px; border: 1px solid #ddd; padding: 2px; }

        .summary-box { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 20px 0; }
        .summary-item { padding: 12px 5px; border-radius: 15px; text-align: center; color: white; }
        .summary-item span { display: block; font-size: 0.7rem; opacity: 0.9; }
        .summary-item strong { font-size: 0.9rem; }

        .table-wrapper { margin-top: 20px; overflow-x: auto; border-radius: 15px; border: 1px solid #EEE; }
        table { width: 100%; border-collapse: collapse; min-width: 500px; font-size: 0.85rem; }
        thead { background: var(--text-dark); color: white; }
        th, td { padding: 10px; text-align: center; border-bottom: 1px solid #F1F3F5; }
        .last-row { background: var(--soft-mint); font-weight: bold; }

        .form-section { display: none; }
        .form-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- åˆ©ç‡å´é‚Šæ¬„å„ªåŒ–æ¨£å¼ --- */
        .side-drawer {
            position: fixed; top: 0; right: -325px; 
            width: 320px; height: 100vh; background: #fff;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 2000;
        }
        .side-drawer.is-open { right: 0; }

        .drawer-trigger {
            position: absolute; left: -45px; top: 50%;
            transform: translateY(-50%); width: 45px; height: 80px;
            background: var(--bright-blue); cursor: pointer;
            clip-path: polygon(100% 0, 0 50%, 100% 100%);
            display: none; align-items: center; justify-content: center; color: white;
            box-shadow: -2px 0 5px rgba(0,0,0,0.1);
        }

        .rate-table-drawer {
            width: 100%; border-collapse: collapse; margin-top: 5px; 
            font-size: 0.85rem;
        }
        .rate-table-drawer th { background: #F8F5F2; padding: 8px 10px; text-align: left; color: #666; border-bottom: 1px solid var(--oat); }
        .rate-table-drawer td { 
            padding: 8px 10px; 
            border-bottom: 1px solid #F1F1F1; 
            white-space: nowrap; 
            vertical-align: middle; 
        }
        
        .cat-row { background: #FAF9F7; font-weight: bold; color: var(--m-purple); }

        .tag { padding: 2px 5px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }
        .tag-ok { background: #E8F5E9; color: #2E7D32; border: 1px solid #C8E6C9; }
        .tag-stop { color: #D32F2F; font-weight: bold; }
    </style>
</head>
<body>

<div onclick="window.location.assign('index.html');" class="back-home">
    <i class="fa-solid fa-house"></i> è¿”å›é¦–é 
</div>

<div class="side-drawer" id="sideDrawer">
    <div class="drawer-trigger" id="drawerTrigger">
        <i class="fa-solid fa-percent" style="margin-left:15px; font-size: 1rem;"></i>
    </div>
    <div style="padding:15px; border-bottom:1px solid #EEE; display:flex; align-items:center; justify-content:space-between;">
        <span style="font-weight:bold; font-size:1rem; color:var(--m-purple)">ğŸ›ï¸ æˆ¿è²¸åˆ©ç‡åƒè€ƒè¡¨</span>
        <button id="closeDrawer" style="background:none; border:none; font-size:1.2rem; cursor:pointer; color:var(--text-dark);">
            <i class="fa-solid fa-xmark"></i>
        </button>
    </div>
    <div style="padding:5px; overflow-y:auto; height:calc(100% - 60px);">
        <table class="rate-table-drawer">
            <thead><tr><th>éŠ€è¡Œæ©Ÿæ§‹</th><th>åˆ©ç‡åƒè€ƒ</th></tr></thead>
            <tbody>
                <tr class="cat-row"><td colspan="2">ğŸŸ¢ æ­£å¸¸æ”¶ä»¶ (å…¬è‚¡è¡Œåº«)</td></tr>
                <tr><td>è‡ºç£éŠ€è¡Œ</td><td><span class="tag tag-ok">æ–°é’å®‰æ”¿ç­–</span></td></tr>
                <tr><td>åœŸåœ°éŠ€è¡Œ</td><td><span class="tag tag-ok">æ–°é’å®‰æ”¿ç­–</span></td></tr>
                <tr><td>åˆä½œé‡‘åº«</td><td><span class="tag tag-ok">æ–°é’å®‰æ”¿ç­–</span></td></tr>
                <tr><td>ç¬¬ä¸€éŠ€è¡Œ</td><td><span class="tag tag-ok">æ–°é’å®‰æ”¿ç­–</span></td></tr>
                <tr><td>è¯å—éŠ€è¡Œ</td><td><span class="tag tag-ok">æ–°é’å®‰æ”¿ç­–</span></td></tr>
                <tr><td>å½°åŒ–éŠ€è¡Œ</td><td><span class="tag tag-ok">æ–°é’å®‰æ”¿ç­–</span></td></tr>
                <tr><td>å…†è±éŠ€è¡Œ</td><td><span class="tag tag-ok">æ–°é’å®‰æ”¿ç­–</span></td></tr>
                <tr><td>è‡ºç£ä¼éŠ€</td><td><span class="tag tag-ok">æ–°é’å®‰æ”¿ç­–</span></td></tr>
                
                <tr class="cat-row"><td colspan="2">ğŸ”µ æ­£å¸¸æ”¶ä»¶ (æ°‘ç‡Ÿ/ç¶²éŠ€)</td></tr>
                <tr><td>å‡±åŸºéŠ€è¡Œ</td><td>2.40% èµ·</td></tr>
                <tr><td>ç‰å±±éŠ€è¡Œ</td><td>2.50% èµ·</td></tr>
                <tr><td>å°‡ä¾†éŠ€è¡Œ</td><td>2.50% èµ·</td></tr>
                <tr><td>å°æ–°éŠ€è¡Œ</td><td>2.55% èµ·</td></tr>
                <tr><td>ç‹é“éŠ€è¡Œ</td><td>2.68% èµ·</td></tr>
                <tr><td>åŒ¯è± / å…ƒå¤§</td><td>2.70% ~ 2.73%</td></tr>
                <tr><td>æ˜Ÿå±• / å°ä¸­</td><td>2.80% èµ·</td></tr>
                
                <tr class="cat-row"><td colspan="2">ğŸŸ  ç‰¹å®šæ¢ä»¶</td></tr>
                <tr><td>åœ‹æ³°/å¯Œé‚¦äººå£½</td><td>2.50% (é™è–ªè½‰)</td></tr>
                <tr><td>è¾²æœƒ / ä¿¡åˆç¤¾</td><td>2.60% èµ·</td></tr>
                <tr><td>åœ‹æ³°ä¸–è¯</td><td>é™ VIP å®¢æˆ¶</td></tr>
                <tr><td>å®‰æ³°éŠ€è¡Œ</td><td>3.50% (å°é¡)</td></tr>
                
                <tr class="cat-row"><td colspan="2">ğŸ”´ æš«åœæ”¶ä»¶</td></tr>
                <tr><td>æ°¸è±éŠ€è¡Œ</td><td><span class="tag-stop">æš«åœå—ç†</span></td></tr>
            </tbody>
        </table>
        <p style="font-size: 0.7rem; color: #999; margin: 15px 10px;">* ä»¥ä¸Šç‚º 2026 Q1 èª¿æŸ¥ï¼Œå¯¦éš›åˆ©ç‡ä»¥å„è¡Œå¯©æ ¸ç‚ºæº–ã€‚</p>
    </div>
</div>

<div class="calc-container">
    <h2><i class="fa-solid fa-calculator"></i> è²¸æ¬¾è©¦ç®—å·¥å…·</h2>
    
    <div class="type-tabs">
        <div class="tab active" onclick="setMode('mortgage')" id="tab-mortgage">ä¸€èˆ¬æˆ¿è²¸</div>
        <div class="tab" onclick="setMode('personal')" id="tab-personal">ä¿¡ç”¨è²¸æ¬¾</div>
        <div class="tab" onclick="setMode('revolving')" id="tab-revolving">ç†è²¡å‹æˆ¿è²¸</div>
    </div>

    <div class="amt-section">
        <div class="amt-label-row">
            <span style="font-weight:900">è²¸æ¬¾é‡‘é¡ (è¬)</span>
            <input type="number" id="amtInp" class="amt-input-big" value="500" oninput="sync('amt')">
        </div>
        <input type="range" id="amtSld" min="10" max="5000" step="10" value="500" oninput="sync('amt')">
    </div>

    <div id="mortgage-options" class="form-section active">
        <div class="input-row">
            <div style="display:flex; justify-content:space-between">
                <label>è²¸æ¬¾å¹´æœŸ</label><span class="val-display" id="mYearTxt">30 å¹´</span>
            </div>
            <input type="range" id="mYearSld" min="10" max="40" value="30" oninput="updateAll()">
        </div>
        <div class="input-row">
            <div style="display:flex; justify-content:space-between">
                <label>å¯¬é™æœŸ (å¹´)</label><span class="val-display" id="graceTxt">0 å¹´</span>
            </div>
            <input type="range" id="graceSld" min="0" max="5" value="0" oninput="updateAll()">
        </div>
        <div class="rate-config">
            <label style="font-weight:bold; cursor:pointer"><input type="checkbox" id="isMultiStep" onchange="toggleRateUI()"> å•Ÿç”¨åˆ†æ®µå¼åˆ©ç‡</label>
            <div id="singleRateUI" style="margin-top:10px">
                å¹´åˆ©ç‡ï¼š<input type="number" id="baseRate" value="2.185" step="0.001" style="width:70px" oninput="updateAll()"> %
            </div>
            <div id="multiRateUI" style="display:none; margin-top:10px">
                <div id="stepContainer">
                    <div class="step-row">
                        ç¬¬ 1 å¹´è‡³ <input type="number" class="step-end" value="2" oninput="updateAll()"> å¹´ï¼šåˆ©ç‡ <input type="number" class="step-rate" value="2.06" step="0.01" oninput="updateAll()"> %
                    </div>
                </div>
                <button onclick="addStep()" style="font-size:0.7rem; cursor:pointer; padding: 2px 8px;">+ æ–°å¢åˆ†æ®µ</button>
            </div>
        </div>
    </div>

    <div id="personal-options" class="form-section">
        <div class="input-row">
            <div style="display:flex; justify-content:space-between">
                <label>å€Ÿæ¬¾å¹´æœŸ</label><span class="val-display" id="pYearTxt">7 å¹´</span>
            </div>
            <input type="range" id="pYearSld" min="1" max="10" value="7" oninput="updateAll()">
        </div>
        <div class="input-row">
            <div style="display:flex; justify-content:space-between">
                <label>å¹´åˆ©ç‡ (%)</label>
                <input type="number" id="pRateInp" value="2.5" step="0.1" style="width:60px" oninput="sync('pRate')">
            </div>
            <input type="range" id="pRateSld" min="1" max="15" step="0.1" value="2.5" oninput="sync('pRate')">
        </div>
    </div>

    <div id="revolving-options" class="form-section">
        <div class="input-row" style="background:var(--soft-mint)">
            <p style="font-size:0.8rem; margin:0 0 10px 0">ç†è²¡å‹æˆ¿è²¸ç‚ºéš¨å€Ÿéš¨é‚„ï¼ŒæŒ‰æ—¥è¨ˆæ¯ã€‚</p>
            <div style="display:flex; justify-content:space-between; align-items:center">
                <label>å¹´åˆ©ç‡ (%)</label>
                <input type="number" id="rRateInp" value="2.5" step="0.1" style="width:60px" oninput="sync('rRate')">
            </div>
            <input type="range" id="rRateSld" min="1" max="10" step="0.1" value="2.5" oninput="sync('rRate')">
        </div>
    </div>

    <div class="summary-box">
        <div class="summary-item" style="background:var(--bright-blue)"><span>é¦–æœŸæœˆä»˜</span><strong id="resFirstPmt">0</strong></div>
        <div class="summary-item" style="background:var(--bright-pink)"><span>ç¸½åˆ©æ¯</span><strong id="resTotalInt">0</strong></div>
        <div class="summary-item" style="background:var(--m-purple)"><span>æœ¬åˆ©ç¸½å’Œ</span><strong id="resTotalAll">0</strong></div>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr><th>æœŸæ•¸</th><th>æœ¬é‡‘</th><th>åˆ©æ¯</th><th>æœˆä»˜é¡</th><th>å‰©é¤˜æœ¬é‡‘</th></tr>
            </thead>
            <tbody id="detailBody"></tbody>
        </table>
    </div>
</div>

<script>
    (function(doc, nav, standalone) {
        if ((standalone in nav) && nav[standalone]) {
            doc.addEventListener('click', function(event) {
                var cnode = event.target;
                while (cnode && cnode.nodeName !== 'A' && cnode.nodeName !== 'HTML') {
                    cnode = cnode.parentNode;
                }
                if (cnode && 'href' in cnode && cnode.href.indexOf('.html') !== -1) {
                    event.preventDefault();
                    window.location.assign(cnode.href);
                }
            }, false);
        }
    })(document, window.navigator, 'standalone');

    document.addEventListener('DOMContentLoaded', function() {
        const drawer = document.getElementById('sideDrawer');
        const trigger = document.getElementById('drawerTrigger');
        const closeBtn = document.getElementById('closeDrawer');

        // é»æ“Šå±•é–‹
        trigger.addEventListener('click', (e) => {
            e.stopPropagation();
            drawer.classList.toggle('is-open');
        });

        // é»æ“Šå³ä¸Šè§’ X é—œé–‰
        closeBtn.addEventListener('click', () => {
            drawer.classList.remove('is-open');
        });

        // é»æ“Šå´é‚Šæ¬„ä»¥å¤–ç¯„åœé—œé–‰
        document.addEventListener('click', (event) => {
            if (!drawer.contains(event.target) && drawer.classList.contains('is-open')) {
                drawer.classList.remove('is-open');
            }
        });

        // ç§»é™¤æ‰€æœ‰æ»‘å‹•(Swipe)é—œé–‰çš„é‚è¼¯
    });

    let currentMode = 'mortgage';

    function setMode(mode) {
        currentMode = mode;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-' + mode).classList.add('active');
        document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
        document.getElementById(mode + '-options').classList.add('active');
        
        const trigger = document.getElementById('drawerTrigger');
        trigger.style.display = (mode === 'mortgage') ? 'flex' : 'none';
        
        updateAll();
    }

    function sync(type) {
        const inp = document.getElementById(type + 'Inp'), sld = document.getElementById(type + 'Sld');
        if(event.target.type === 'range') inp.value = sld.value; else sld.value = inp.value;
        updateAll();
    }

    function toggleRateUI() {
        const isMulti = document.getElementById('isMultiStep').checked;
        document.getElementById('singleRateUI').style.display = isMulti ? 'none' : 'block';
        document.getElementById('multiRateUI').style.display = isMulti ? 'block' : 'none';
        updateAll();
    }

    function addStep() {
        const container = document.getElementById('stepContainer');
        const lastYear = parseInt(container.querySelector('.step-row:last-child .step-end').value);
        const div = document.createElement('div');
        div.className = 'step-row';
        div.innerHTML = `ç¬¬ ${lastYear + 1} å¹´è‡³ <input type="number" class="step-end" value="${lastYear + 5}" oninput="updateAll()"> å¹´ï¼šåˆ©ç‡ <input type="number" class="step-rate" value="2.3" step="0.01" oninput="updateAll()"> % <button onclick="this.parentElement.remove();updateAll();">x</button>`;
        container.appendChild(div);
        updateAll();
    }

    function updateAll() {
        if(currentMode === 'mortgage') {
            document.getElementById('mYearTxt').innerText = document.getElementById('mYearSld').value + " å¹´";
            document.getElementById('graceTxt').innerText = document.getElementById('graceSld').value + " å¹´";
            document.getElementById('drawerTrigger').style.display = 'flex';
        } else if(currentMode === 'personal') {
            document.getElementById('pYearTxt').innerText = document.getElementById('pYearSld').value + " å¹´";
        }
        calculate();
    }

    function calculate() {
        const principal = Math.round(parseFloat(document.getElementById('amtInp').value) * 10000);
        if (isNaN(principal) || principal <= 0) return;

        if(currentMode === 'revolving') {
            const rRate = parseFloat(document.getElementById('rRateInp').value) / 100 / 365;
            const dailyInt = Math.round(principal * rRate);
            document.getElementById('resFirstPmt').innerText = "NT$" + (dailyInt * 30).toLocaleString();
            document.getElementById('resTotalInt').innerText = "æŒ‰æ—¥è¨ˆæ¯";
            document.getElementById('resTotalAll').innerText = "éš¨å€Ÿéš¨é‚„";
            document.getElementById('detailBody').innerHTML = "<tr><td colspan='5'>ç†è²¡å‹æˆ¿è²¸æŒ‰æ—¥è¨ˆæ¯ï¼Œå€Ÿå¤šå°‘ç®—å¤šå°‘ã€‚</td></tr>";
            return;
        }

        let years = (currentMode === 'mortgage') ? parseInt(document.getElementById('mYearSld').value) : parseInt(document.getElementById('pYearSld').value);
        let graceMonths = (currentMode === 'mortgage') ? parseInt(document.getElementById('graceSld').value) * 12 : 0;
        const totalMonths = years * 12;

        let balance = principal;
        let html = '';
        let totalInt = 0;

        for (let m = 1; m <= totalMonths; m++) {
            let rate = (currentMode === 'mortgage') ? parseFloat(document.getElementById('baseRate').value) : parseFloat(document.getElementById('pRateInp').value);
            
            if (currentMode === 'mortgage' && document.getElementById('isMultiStep').checked) {
                const steps = document.querySelectorAll('.step-row');
                for (let s of steps) {
                    if (m <= parseInt(s.querySelector('.step-end').value) * 12) {
                        rate = parseFloat(s.querySelector('.step-rate').value);
                        break;
                    }
                }
            }

            let monthlyRate = rate / 100 / 12;
            let interest = Math.round(balance * monthlyRate);
            let pRepaid = 0;
            let pmt = 0;

            if (m <= graceMonths) {
                pmt = interest;
            } else {
                let remM = totalMonths - m + 1;
                pmt = Math.round((balance * monthlyRate * Math.pow(1+monthlyRate, remM)) / (Math.pow(1+monthlyRate, remM) - 1));
                pRepaid = pmt - interest;
            }

            if (m === totalMonths) { pRepaid = balance; pmt = pRepaid + interest; balance = 0; }
            else { balance -= pRepaid; }

            totalInt += interest;
            if(m === 1) document.getElementById('resFirstPmt').innerText = "NT$" + pmt.toLocaleString();

            if (m <= 120 || m === totalMonths) {
                html += `<tr class="${m === totalMonths ? 'last-row' : ''}"><td>${m}</td><td>${pRepaid.toLocaleString()}</td><td>${interest.toLocaleString()}</td><td>${pmt.toLocaleString()}</td><td>${Math.max(0, balance).toLocaleString()}</td></tr>`;
            } else if (m === 121) {
                html += `<tr><td colspan="5">...... ä¸­ç•¥ ......</td></tr>`;
            }
        }

        document.getElementById('resTotalInt').innerText = "NT$" + totalInt.toLocaleString();
        document.getElementById('resTotalAll').innerText = "NT$" + (principal + totalInt).toLocaleString();
        document.getElementById('detailBody').innerHTML = html;
    }

    window.onload = updateAll;
</script>
</body>
</html>
