<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DISC 專業行為風格報告</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #6C5CE7; --secondary: #A29BFE; --bg: #f4f7f6; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        .navbar { position: fixed; top: 0; width: 100%; height: 50px; background: rgba(255,255,255,0.9); backdrop-filter: blur(5px); display: flex; align-items: center; padding: 0 20px; z-index: 1000; box-sizing: border-box; }
        .btn-home { background: #eee; border: none; padding: 5px 15px; border-radius: 8px; cursor: pointer; color: #555; }
        .welcome-card { background: white; border-radius: 30px; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.1); text-align: center; margin: 80px auto 20px; max-width: 450px; width: 90%; }
        .welcome-header { background: linear-gradient(135deg, #6C5CE7, #8E78FF); padding: 40px 20px; color: white; }
        .welcome-header i { font-size: 3rem; margin-bottom: 15px; }
        .welcome-header h2 { margin: 0; font-size: 1.6rem; letter-spacing: 2px; }
        .input-section { padding: 40px 30px; }
        .input-group { position: relative; margin-bottom: 30px; }
        .input-group i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #aaa; }
        input[type="text"] { width: 100%; padding: 15px 15px 15px 45px; border: 2px solid #f0f0f0; border-radius: 15px; font-size: 1rem; box-sizing: border-box; transition: all 0.3s; outline: none; background: #f9f9f9; }
        .container { max-width: 650px; margin: 80px auto 20px; background: #fff; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); display: none; }
        #q-title { font-size: 1.2rem; line-height: 1.6; margin-bottom: 25px; color: #2D3436; min-height: 3.6rem; text-align: left; }
        .option-btn { display: block; width: 100%; padding: 18px 20px; margin: 12px 0; background: #fff; border: 2px solid #f0f0f0; border-radius: 15px; cursor: pointer; text-align: left; font-size: 1rem; color: #444; transition: all 0.2s ease; }
        .option-btn:active { transform: scale(0.98); background: #f0edff; border-color: var(--primary); color: var(--primary); }
        .progress-container { background: #eee; height: 10px; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        .progress-bar { background: linear-gradient(90deg, var(--secondary), var(--primary)); height: 100%; width: 0%; transition: 0.3s; }
        .report-header { background: linear-gradient(135deg, #6C5CE7, #8E78FF); color: white; padding: 30px 20px; border-radius: 15px 15px 0 0; text-align: center; }
        .analysis-card { background: #fdfdfd; border-left: 5px solid var(--primary); padding: 18px; margin-bottom: 15px; border-radius: 0 10px 10px 0; text-align: left; }
        .analysis-card h4 { margin: 0 0 8px 0; color: var(--primary); font-size: 1.05rem; }
        .analysis-card p { margin: 0; font-size: 0.95rem; line-height: 1.6; color: #555; }
        .btn-main { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 15px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: transform 0.2s; }
    </style>
</head>
<body>

    <nav class="navbar"><button class="btn-home" onclick="location.reload()"><i class="fa-solid fa-chevron-left"></i> 返回</button></nav>

    <div id="view-name" class="welcome-card">
        <div class="welcome-header">
            <i class="fa-solid fa-rocket"></i>
            <h2>DISC 風格診斷</h2>
            <p style="margin-top:10px; opacity: 0.8; font-size: 0.9rem;">探索您的職場競爭力與溝通密碼</p>
        </div>
        <div class="input-section">
            <div class="input-group">
                <i class="fa-solid fa-user"></i>
                <input type="text" id="user-name" placeholder="請輸入您的姓名或暱稱">
            </div>
            <button class="btn-main" onclick="nextToStart()">開始探索之旅</button>
        </div>
    </div>

    <div class="container" id="quiz-container">
        <div id="view-quiz">
            <div class="progress-container"><div id="pb" class="progress-bar"></div></div>
            <h3 id="q-title"></h3>
            <div id="options-box"></div>
        </div>

        <div id="view-report" style="display:none; text-align: center;">
            <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;"><i class="fa-solid fa-circle-info"></i> 長按下方圖片即可另存分析結果</p>
            
            <div id="report-img-container"></div>

            <div id="capture-area" style="position: absolute; left: -9999px; width: 600px;">
                <div class="report-header">
                    <h2 id="out-name" style="margin:0;"></h2>
                    <p style="opacity: 0.9; margin: 5px 0 0 0;">DISC Professional Analysis Report</p>
                </div>
                <div style="padding:25px; background: white; border-radius: 0 0 15px 15px; border: 1px solid #eee; border-top: none;">
                    <div style="display:flex; justify-content:center; align-items:center; gap:25px; margin:20px 0;">
                        <img id="out-img" src="" style="width:100px; height:100px; object-fit: contain;">
                        <div style="text-align:left;">
                            <span style="color:#888; font-size: 0.9rem;">主屬性特質</span>
                            <h2 id="out-code" style="color:var(--primary); margin:0; font-size: 2rem;"></h2>
                        </div>
                    </div>
                    <div style="height:250px; margin-bottom: 30px;"><canvas id="discChart"></canvas></div>
                    <div id="analysis-list"></div>
                    <div style="text-align:right; font-size:0.7rem; color:#ccc; margin-top:15px;">數位工具箱專業測驗模組 © 2026</div>
                </div>
            </div>

            <button class="btn-main" style="background:#666; margin-top:20px;" onclick="location.reload()">重新測驗</button>
        </div>
    </div>

<script>
    const depthLib = {
        "D": "老虎型（支配者）：具備強大決斷力，以目標為導向，不畏挑戰。",
        "I": "孔雀型（影響者）：展現極佳社交魅力，擅長說服他人並營造氣氛。",
        "S": "無尾熊型（穩健者）：重視和諧與團隊，是穩定且值得信賴的合作夥伴。",
        "C": "貓頭鷹型（分析者）：講求邏輯與精確，對品質與細節有極高標準。",
        "變色龍": "變色龍型：您的分數非常平均，具備極高的環境適應力與彈性，能根據不同情境快速調整自己的行為風格，是極佳的協調者。"
    };

    const questions = [
        { q: "1. 當你和朋友一起用餐時，在選擇吃什麼時，你常是：", o: ["決定者", "氣氛製造者", "附和者", "意見提供者"] },
        { q: "2. 當你買衣服時，你是：", o: ["心中自有定見", "售貨員親切促成", "找熟悉的店購買", "注意品質與價錢"] },
        { q: "3. 你的消費習慣是：", o: ["找到東西付錢走人", "很隨意的逛", "不愛變化", "注意品質與成本"] },
        { q: "4. 你的朋友通常形容你：", o: ["蠻鴨霸的", "熱情洋溢", "溫和斯文", "要求完美"] },
        { q: "5. 你自認哪種形容最貼切：", o: ["果敢能接受挑戰", "生動活潑", "愛傾聽喜歡穩定", "處世謹慎重數據"] },
        { q: "6. 做事重點應該是：", o: ["What (重結果)", "Who (重感受)", "How (重執行)", "Why (重品質)"] },
        { q: "7. 與同事衝突時：", o: ["說服對方", "尋求支持", "退讓以和為貴", "協調找最佳方案"] },
        { q: "8. 哪種環境最能鼓舞你：", o: ["能決定事情", "相處愉快受歡迎", "穩定中求發展", "講品質重效率"] },
        { q: "9. 溝通方式最符合的是：", o: ["直接權威", "表情肢體豐富", "溫和表達", "冷靜理多於情"] },
        { q: "10. 會議中的角色：", o: ["據理力爭者", "協調者", "贊同多數者", "分析提案"] },
        { q: "11. 關於做事與目標：", o: ["快速得到結果", "喜歡跟人交往", "不強出頭", "守紀律自律"] },
        { q: "12. 環境偏好：", o: ["激烈競爭", "喜歡社交招待", "固守程序", "花時間研究"] },
        { q: "13. 關於成功與冒險：", o: ["只要成功就好", "在意他人意見", "少冒險較好", "高標準期望"] },
        { q: "14. 關於工作熱情：", o: ["處理棘手問題", "熱心喜歡共事", "委婉溫和", "較少閒聊"] },
        { q: "15. 關於團體意識：", o: ["有競爭才有潛能", "不注意細節", "順著群眾", "講求證據"] },
        { q: "16. 關於能力與細節：", o: ["追求能力權威", "有時情緒化", "穩紮穩打", "注意細節"] },
        { q: "17. 關於掌握與傾向：", o: ["掌握支配他人", "喜歡打成一片", "遵守步驟", "掌握事實"] },
        { q: "18. 關於溝通直接度：", o: ["不兜圈子", "喜歡幫助人", "要穩定安全", "高品質要求"] },
        { q: "19. 關於標準程序：", o: ["不喜人逗開心", "喜歡團體活動", "有耐心靜靜做", "要有計劃"] },
        { q: "20. 關於被支配感：", o: ["討厭被告知如何做", "生氣勃勃", "喜歡獨處", "會找更多資料"] }
    ];

    let scores = { D: 0, I: 0, S: 0, C: 0 };
    let currentIdx = 0;
    let userName = "";

    function nextToStart() {
        userName = document.getElementById('user-name').value.trim();
        if(!userName) return alert("請輸入您的姓名以開啟報告");
        document.getElementById('view-name').style.display = 'none';
        document.getElementById('quiz-container').style.display = 'block';
        renderQuestion();
    }

    function renderQuestion() {
        const q = questions[currentIdx];
        document.getElementById('q-title').innerText = q.q;
        document.getElementById('pb').style.width = ((currentIdx / 20) * 100) + "%";
        const box = document.getElementById('options-box');
        box.innerHTML = "";
        const types = ['D', 'I', 'S', 'C'];
        q.o.forEach((txt, i) => {
            const btn = document.createElement('button');
            btn.className = "option-btn";
            btn.innerText = txt;
            btn.onclick = () => {
                scores[types[i]]++;
                currentIdx++;
                if(currentIdx < 20) renderQuestion(); else showReport();
            };
            box.appendChild(btn);
        });
    }

    function showReport() {
        document.getElementById('view-quiz').style.display = 'none';
        document.getElementById('view-report').style.display = 'block';
        
        const sorted = Object.entries(scores).sort((a,b) => b[1] - a[1]);
        const maxScore = sorted[0][1];
        const minScore = sorted[3][1];
        
        // 變色龍邏輯：最高與最低差距 <= 2 且最低分 > 0
        const isChameleon = (maxScore - minScore <= 2) && minScore > 0;
        
        const list = document.getElementById('analysis-list');
        list.innerHTML = "";
        let finalTypeLabel = "";

        if (isChameleon) {
            finalTypeLabel = "變色龍型";
            document.getElementById('out-img').src = "chameleon.png"; 
            addCard(list, "核心人格分析", depthLib["變色龍"]);
        } else {
            const topTrait = sorted[0][0];
            const traitNames = { D: "老虎型", I: "孔雀型", S: "無尾熊型", C: "貓頭鷹型" };
            finalTypeLabel = traitNames[topTrait];
            document.getElementById('out-img').src = { D: "tiger.png", I: "peacock.png", S: "koala.png", C: "owl.png" }[topTrait];
            addCard(list, `主要性格特質：${finalTypeLabel}`, depthLib[topTrait]);
        }

        document.getElementById('out-name').innerText = userName + " 的行為風格報告";
        document.getElementById('out-code').innerText = finalTypeLabel;

        drawChartAndCapture();
    }

    function addCard(parent, title, text) {
        const div = document.createElement('div');
        div.className = "analysis-card";
        div.innerHTML = `<h4>● ${title}</h4><p>${text}</p>`;
        parent.appendChild(div);
    }

    function drawChartAndCapture() {
        new Chart(document.getElementById('discChart'), {
            type: 'bar',
            data: {
                labels: ['D 老虎', 'I 孔雀', 'S 無尾熊', 'C 貓頭鷹'],
                datasets: [{
                    data: [scores.D, scores.I, scores.S, scores.C],
                    backgroundColor: ['#FF6B6B', '#FFD93D', '#6BCB77', '#4D96FF'],
                    borderRadius: 5
                }]
            },
            options: { 
                indexAxis: 'y', 
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                animation: {
                    onComplete: function() {
                        html2canvas(document.getElementById('capture-area'), { scale: 2 }).then(canvas => {
                            const img = new Image();
                            img.src = canvas.toDataURL("image/png");
                            img.style.width = "100%";
                            img.style.maxWidth = "500px";
                            img.style.borderRadius = "15px";
                            img.style.boxShadow = "0 10px 30px rgba(0,0,0,0.1)";
                            const container = document.getElementById('report-img-container');
                            container.innerHTML = "";
                            container.appendChild(img);
                        });
                    }
                }
            }
        });
    }
</script>
</body>
</html>
