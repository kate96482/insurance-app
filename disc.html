<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DISC è¡Œç‚ºé¢¨æ ¼è¨ºæ–·å°åŠ©æ‰‹</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #6C5CE7; --bg: #f8f9fa; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding-top: 60px; -webkit-user-select: none; }
        
        /* é ‚ç«¯å°è¦½åˆ— */
        .navbar { position: fixed; top: 0; width: 100%; height: 50px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; padding: 0 20px; z-index: 1000; box-sizing: border-box; }
        .btn-home { background: #eee; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; }

        .container { max-width: 600px; margin: 20px auto; background: #fff; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        
        /* æ¸¬é©—å€ */
        .progress-container { background: #eee; height: 10px; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        .progress-bar { background: var(--primary); height: 100%; width: 0%; transition: 0.3s; }
        .option-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; background: #fff; border: 1px solid #ddd; border-radius: 10px; cursor: pointer; text-align: left; transition: 0.2s; font-size: 1rem; }
        .option-btn:active { background: #f0edff; border-color: var(--primary); }

        .nav-actions { display: flex; gap: 10px; margin-top: 20px; }
        .btn-secondary { flex: 1; padding: 12px; background: #f1f1f1; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; color: #666; }

        /* å ±å‘Šå€ */
        #capture-area { background: #fff; padding: 25px; border: 1px solid #eee; border-radius: 10px; }
        .result-header { text-align: center; margin-bottom: 20px; }
        .animal-icon { width: 140px; height: 140px; margin: 10px auto; display: block; object-fit: contain; -webkit-user-select: auto; }
        .chart-box { margin: 20px 0; height: 250px; }
        .analysis-text { background: #f9f9f9; padding: 20px; border-radius: 10px; line-height: 1.8; color: #444; text-align: left; }
        .analysis-text strong { color: var(--primary); font-size: 1.1rem; }
        
        .save-hint { text-align: center; color: #ff6b6b; font-size: 0.9rem; margin: 10px 0; font-weight: bold; }
        .btn-primary { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1rem; margin-top: 10px; }
    </style>
</head>
<body>

    <nav class="navbar">
        <button class="btn-home" onclick="confirmExit()">è¿”å›é¦–é </button>
    </nav>

    <div class="container">
        <div id="view-name">
            <h2>DISC æ¸¬é©—å°åŠ©æ‰‹</h2>
            <p style="text-align: center; color: #666;">é–‹å§‹å‰ï¼Œè«‹å‘Šè¨´æˆ‘å€‘æ‚¨çš„ç¨±å‘¼ï¼š</p>
            <div style="text-align: center;">
                <input type="text" id="user-name" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
                <button class="btn-primary" onclick="goToStart()">ä¸‹ä¸€æ­¥</button>
            </div>
        </div>

        <div id="view-start" style="display:none;">
            <h3>æ‚¨å¥½ï¼Œ<span id="display-name"></span>ï¼</h3>
            <p style="line-height: 1.6;">æœ¬æ¸¬é©—åŒ…å« 20 é¡Œï¼Œè«‹æŒ‰ç›´è¦ºé¸å‡ºç­”æ¡ˆã€‚æ‚¨çš„æ¯ä¸€æ¬¡é¸æ“‡éƒ½æœƒè¢«è¨˜éŒ„ï¼Œéš¨æ™‚å¯ä»¥è¿”å›ä¸Šä¸€é¡Œä¿®æ”¹ã€‚</p>
            <button class="btn-primary" onclick="startQuiz()">é–‹å§‹æ¸¬é©—</button>
        </div>

        <div id="view-quiz" style="display:none;">
            <div class="progress-container"><div class="progress-bar" id="pb"></div></div>
            <h3 id="q-title" style="text-align: left; min-height: 60px;"></h3>
            <div id="options-box"></div>
            <div class="nav-actions">
                <button id="btn-back" class="btn-secondary" onclick="prevQuestion()" style="display:none;">å›ä¸Šä¸€é¡Œ</button>
            </div>
        </div>

        <div id="view-report" style="display:none;">
            <div id="capture-area">
                <div class="result-header">
                    <h2 id="report-user-name" style="margin-bottom: 5px;"></h2>
                    <p style="color: #888; margin-top: 0;">DISC å°ˆå±¬è¡Œç‚ºé¢¨æ ¼è¨ºæ–·å ±å‘Š</p>
                    <img id="animal-img" src="" class="animal-icon" alt="äººæ ¼å‹•ç‰©">
                    <h1 id="result-type" style="color: var(--primary); margin: 10px 0;"></h1>
                </div>
                <div class="chart-box"><canvas id="discChart"></canvas></div>
                <div class="analysis-text">
                    <strong>ã€äººæ ¼ç‰¹è³ªè§£æã€‘</strong><br>
                    <span id="depth-desc"></span><br><br>
                    <strong>ã€å±¬æ€§ç‰¹è‰²èªªæ˜ã€‘</strong><br>
                    <span id="main-desc"></span>
                </div>
            </div>
            
            <p class="save-hint">ğŸ’¡ æç¤ºï¼šæ‰‹æ©Ÿç”¨æˆ¶å¯é•·æŒ‰åœ–ç‰‡å¦å­˜åˆ†æåœ–</p>
            <button class="btn-primary" onclick="downloadImage()">é»æ­¤å¦å­˜åˆ†æå ±å‘Šåœ–æª”</button>
            <button class="btn-primary" style="background:#666;" onclick="location.reload()">é‡æ–°æ¸¬é©—</button>
        </div>
    </div>

<script>
    // æ·±åº¦è§£ææ–‡æ¡ˆè³‡æ–™åº«
    const depthAnalysisLib = {
        "D": "ã€å–®ä¸€è€è™å‹ã€‘å…·å‚™å¼·å¤§çš„é–‹å‰µåŠ›èˆ‡æ±ºæ–·åŠ›ã€‚æ‚¨æ˜¯å¤©ç”Ÿçš„é ˜å°è€…ï¼Œå°ˆæ³¨æ–¼é”æˆç›®æ¨™ï¼Œä¸ç•æ‡¼è¡çªèˆ‡æŒ‘æˆ°ã€‚",
        "I": "ã€å–®ä¸€å­”é›€å‹ã€‘æ“æœ‰æ¥µä½³çš„äººéš›å¸å¼•åŠ›ã€‚æ‚¨æ“…é•·å¸¶å‹•æ°£æ°›ï¼Œé€éç†±æƒ…èˆ‡èªè¨€å½±éŸ¿ä»–äººï¼Œæ˜¯åœ˜éšŠä¸­çš„ç™¼å…‰é«”ã€‚",
        "S": "ã€å–®ä¸€ç„¡å°¾ç†Šå‹ã€‘å±•ç¾æ¥µé«˜çš„ç©©å®šæ€§èˆ‡è€å¿ƒã€‚æ‚¨é‡è¦–äººéš›å’Œè«§èˆ‡ç¨‹åºï¼Œæ˜¯å€¼å¾—ä¿¡è³´ä¸”æº«æš–çš„åˆä½œå¤¥ä¼´ã€‚",
        "C": "ã€å–®ä¸€è²“é ­é·¹å‹ã€‘å¼·èª¿é‚è¼¯èˆ‡ç²¾ç¢ºã€‚æ‚¨å°å“è³ªæœ‰æ¥µé«˜è¦æ±‚ï¼Œæ“…é•·åˆ†æèˆ‡è¦åŠƒï¼Œç¢ºä¿æ¯ä»¶äº‹éƒ½èƒ½æº–ç¢ºç„¡èª¤ã€‚",
        "DI": "ã€DI é›™é‡ç‰¹è³ªï¼šé–‹æ‹“å½±éŸ¿è€…ã€‘çµåˆäº†è€è™çš„æœæ•¢èˆ‡å­”é›€çš„ç†±æƒ…ã€‚æ‚¨æ—¢èƒ½è¨­å®šç›®æ¨™ï¼Œåˆèƒ½å¸¶å‹•æ°£æ°›ä¸¦èªªæœä»–äººã€‚",
        "DS": "ã€DS é›™é‡ç‰¹è³ªï¼šç©©å¥åŸ·è¡Œè€…ã€‘è€è™çš„å¯¦è¸åŠ›é…ä¸Šç„¡å°¾ç†Šçš„è€æ€§ã€‚åšäº‹æœ‰å§‹æœ‰çµ‚ï¼Œæ—¢èƒ½æ‰¿å—æŒ‘æˆ°ä¹Ÿèƒ½ä¿æŒç©©å®šã€‚",
        "DC": "ã€DC é›™é‡ç‰¹è³ªï¼šå®Œç¾çµ±ç±Œè€…ã€‘è€è™çš„çµæœå°å‘çµåˆè²“é ­é·¹çš„åš´è¬¹ã€‚å°å“è³ªè¦æ±‚æ¥µé«˜ï¼Œåšäº‹ç²¾ç¢ºä¸”æœ‰æ•ˆç‡ã€‚",
        "IS": "ã€IS é›™é‡ç‰¹è³ªï¼šè¦ªå’Œå”èª¿è€…ã€‘å­”é›€çš„é­…åŠ›åŠ ä¸Šç„¡å°¾ç†Šçš„è¦ªåˆ‡ã€‚æ‚¨æ˜¯å¤©ç”Ÿçš„å”èª¿é«˜æ‰‹ï¼Œé‡è¦–äººéš›å’Œè«§ï¼Œèƒ½è´å¾—ä¿¡ä»»ã€‚",
        "IC": "ã€IC é›™é‡ç‰¹è³ªï¼šé‚è¼¯æ¨å»£è€…ã€‘å­”é›€çš„å‰µæ„èˆ‡è²“é ­é·¹çš„åˆ†æã€‚æ‚¨èƒ½ç”¨ç²¾æº–çš„æ•¸æ“šæ”¯æŒæ„Ÿæ€§çš„æƒ³æ³•ï¼ŒèªªæœåŠ›æ¥µå¼·ã€‚",
        "SC": "ã€SC é›™é‡ç‰¹è³ªï¼šè¬¹æ…å¹•åƒšã€‘ç„¡å°¾ç†Šçš„ç©©å®šåŠ ä¸Šè²“é ­é·¹çš„ç´°ç·»ã€‚æ‚¨æ˜¯å®Œç¾çš„æŠ€è¡“æ´¾ï¼Œå‡¡äº‹è¬›æ±‚æµç¨‹èˆ‡æº–ç¢ºã€‚",
        "DIC": "ã€DIC ä¸‰é‡ç‰¹è³ªï¼šå…¨æ‰å‹æ±ºç­–è€…ã€‘å…·å‚™æŒæ§ã€å½±éŸ¿èˆ‡åˆ†æåŠ›ã€‚èƒ½åœ¨è®Šå‹•ä¸­å¿«é€Ÿåˆ†æä¸¦åšå‡ºå…·æ„Ÿå¬åŠ›çš„æ±ºç­–ã€‚",
        "DIS": "ã€DIS ä¸‰é‡ç‰¹è³ªï¼šç†±æƒ…å¯¦è¸å®¶ã€‘å…¼å…·è¡Œå‹•åŠ›ã€ç¤¾äº¤èˆ‡è€åŠ›ã€‚æ—¢èƒ½è¡é‹’é™·é™£ä¹Ÿèƒ½å®‰æ’«äººå¿ƒï¼Œæ˜¯éå¸¸å„ªç§€çš„äººéš›é ˜è¢–ã€‚",
        "ISC": "ã€ISC ä¸‰é‡ç‰¹è³ªï¼šå…¨æ–¹ä½å”èª¿å®˜ã€‘èåˆç¤¾äº¤ã€ç©©å®šèˆ‡åš´è¬¹ã€‚æ“…é•·åœ¨è¦å‰‡èˆ‡æƒ…æ„Ÿä¹‹é–“æ‰¾åˆ°å¹³è¡¡ã€‚",
        "DSC": "ã€DSC ä¸‰é‡ç‰¹è³ªï¼šç²¾æº–åŸ·è¡Œé•·ã€‘æ“æœ‰å¼·å¤§çš„ä»»å‹™åŸ·è¡Œèˆ‡å“è³ªæ§ç®¡èƒ½åŠ›ã€‚å°ˆæ³¨æ–¼ç©©å®šã€ç²¾ç¢ºåœ°é”æˆç›®æ¨™ã€‚",
        "è®Šè‰²é¾": "ã€è®Šè‰²é¾å‹ï¼šå…¨æ–¹ä½å¹³è¡¡ã€‘æ‚¨åœ¨ä¸åŒç’°å¢ƒä¸­èƒ½å¿«é€Ÿèª¿æ•´è§’è‰²ï¼Œå…·å‚™æ¥µä½³çš„é©æ‡‰åŠ›èˆ‡äº¤æ¶‰èƒ½åŠ›ã€‚"
    };

    const questions = [
        { q: "1. ç•¶ä½ å’Œæœ‹å‹ä¸€èµ·ç”¨é¤æ™‚ï¼Œåœ¨é¸æ“‡åƒä»€éº¼æ™‚ï¼Œä½ å¸¸æ˜¯ï¼š", o: ["æ±ºå®šè€…", "æ°£æ°›è£½é€ è€…", "é™„å’Œè€…", "æ„è¦‹æä¾›è€…"] },
        { q: "2. ç•¶ä½ è²·è¡£æœæ™‚ï¼Œä½ æ˜¯ï¼š", o: ["å¿ƒä¸­è‡ªæœ‰å®šè¦‹", "å”®è²¨å“¡è¦ªåˆ‡æ„Ÿå¸¸ä¿ƒæˆè³¼è²·", "æ‰¾ç†Ÿæ‚‰çš„åº—è³¼è²·", "æ³¨æ„å“è³ªèˆ‡åƒ¹éŒ¢æ¯”ä¾‹"] },
        { q: "3. ä½ çš„æ¶ˆè²»ç¿’æ…£æ˜¯ï¼š", o: ["æ‰¾åˆ°è¦è²·çš„æ±è¥¿ï¼Œä»˜éŒ¢èµ°äºº", "å¾ˆéš¨æ„çš„é€›ï¼Œä¸ç‰¹å®šè²·ä»€éº¼", "æœ‰ä¸€å®šçš„æ¶ˆè²»ç¿’æ…£ï¼Œä¸å¤ªå–œæ­¡è®ŠåŒ–", "æ³¨æ„æ±è¥¿å¥½ä¸å¥½ï¼Œæœ‰æˆæœ¬è§€å¿µ"] },
        { q: "4. ä½ çš„æœ‹å‹ï¼Œä»¥ä¸€å¥è©±ä¾†å½¢å®¹ä½ ï¼Œä»–å€‘æœƒèªªï¼š", o: ["è »ã€Œé´¨éœ¸ã€çš„", "ç†±æƒ…æ´‹æº¢", "æº«å’Œæ–¯æ–‡", "è¦æ±‚å®Œç¾"] },
        { q: "5. ä½ è‡ªèªé‚£ä¸€ç¨®å½¢å®¹ï¼Œæœ€èƒ½è¡¨ç¾ä½ çš„ç‰¹è‰²ï¼š", o: ["æœæ•¢çš„ï¼Œèƒ½æ¥å—æŒ‘æˆ°", "ç”Ÿå‹•æ´»æ½‘ï¼Œä¸æ‹˜å°ç¯€", "æ„›å‚¾è½ï¼Œå–œæ­¡ç©©å®š", "è™•ä¸–è¬¹æ…å°å¿ƒï¼Œé‡æ•¸æ“šåˆ†æ"] },
        { q: "6. ä½ è¦ºå¾—åšäº‹çš„é‡é»ï¼Œæ‡‰è©²æ˜¯ï¼š", o: ["Whatï¼Œåšä»€éº¼ï¼Ÿé‡çµæœ", "Whoï¼Œèª°ä¾†åšï¼Ÿé‡æ„Ÿå—", "Howï¼Œæ€éº¼åšï¼Ÿé‡åŸ·è¡Œ", "Whyï¼Œç‚ºä½•åšï¼Ÿé‡å“è³ª"] },
        { q: "7. èˆ‡åŒäº‹æœ‰æ„è¦‹è¡çªæ™‚ï¼Œä½ æ˜¯ï¼š", o: ["èªªæœå°æ–¹ï¼Œè½å¾è‡ªå·±æ„è¦‹", "å•ä»–äººæ„è¦‹ï¼Œå°‹æ±‚æ”¯æŒ", "é€€è®“ï¼Œä»¥å’Œç‚ºè²´", "èˆ‡è¡çªè€…å”èª¿ï¼Œæ‰¾å°‹æœ€å¥½æ„è¦‹"] },
        { q: "8. ä»€éº¼æ¨£çš„å·¥ä½œç’°å¢ƒï¼Œæœ€èƒ½é¼“èˆä½ ï¼š", o: ["èƒ½è®“ä½ æ±ºå®šäº‹æƒ…ï¼Œå…·é ˜å°åœ°ä½", "åŒäº‹ç›¸è™•æ„‰å¿«ï¼Œå—æ­¡è¿", "ç©©å®šä¸­æ±‚ç™¼å±•", "è¬›å“è³ªï¼Œé‡æ•ˆç‡çš„å·¥ä½œ"] },
        { q: "9. ä»¥ä¸‹çš„æºé€šæ–¹å¼ï¼Œé‚£ä¸€é …æœ€ç¬¦åˆä½ ï¼š", o: ["ç›´æ¥äº†ç•¶ï¼Œè¼ƒæ¬Šå¨å¼çš„", "è¡¨æƒ…è±å¯Œï¼Œè‚¢é«”èªè¨€å¤š", "å…ˆè½åˆ¥äººæ„è¦‹å¾Œæº«å’Œè¡¨é”", "ä¸éœ²æ„Ÿæƒ…ï¼Œç†å¤šæ–¼æƒ…ï¼Œè¼ƒå†·éœ"] },
        { q: "10. åœ¨æœƒè­°ä¸­ï¼Œä½ æ‰€æ‰®æ¼”çš„è§’è‰²ç‚ºä½•ï¼š", o: ["æ“šç†åŠ›çˆ­è€…", "å”èª¿è€…", "è´ŠåŒå¤šæ•¸è€…", "åˆ†ææ‰€æœ‰ææ¡ˆä»¥ä¾›åƒè€ƒè€…"] },
        { q: "11. é—œæ–¼åšäº‹èˆ‡ç›®æ¨™ï¼š", o: ["æ±ºå®šå¿«é€Ÿï¼Œç«‹å³å¾—åˆ°çµæœ", "å–œæ­¡è·Ÿäººäº¤å¾€ï¼Œé™Œç”Ÿäººä¹Ÿè¡Œ", "ä¸å–œæ­¡å¼·å‡ºé ­ï¼Œå¯§å¯ç•¶å¾Œè£œ", "è‡ªæˆ‘ç´„æŸï¼Œå¾ˆå®ˆç´€å¾‹"] },
        { q: "12. é—œæ–¼ç’°å¢ƒåå¥½ï¼š", o: ["å–œæ­¡è®ŠåŒ–ã€æ¿€çƒˆä¸”ç«¶çˆ­", "å–œæ­¡ç¤¾äº¤ï¼Œå–œæ­¡æ‹›å¾…äºº", "æˆç‚ºå°çµ„ä¸€ä»½å­ï¼Œå›ºå®ˆç¨‹åº", "èŠ±å¾ˆå¤šæ™‚é–“ç ”ç©¶äº‹èˆ‡äºº"] },
        { q: "13. é—œæ–¼æˆåŠŸèˆ‡å†’éšªï¼š", o: ["æŒ‰è‡ªå·±æ–¹æ³•åšäº‹ï¼Œåªè¦æˆåŠŸ", "èˆ‡äººæ„è¦‹ä¸ä¸€æœƒé›£é", "å°‘å†’éšªä¾†çš„å¥½", "é«˜æ¨™æº–æœŸæœ›"] },
        { q: "14. é—œæ–¼å·¥ä½œç†±æƒ…ï¼š", o: ["æ“…é•·è™•ç†æ£˜æ‰‹å•é¡Œ", "ç†±å¿ƒï¼Œå–œæ­¡ä¸€èµ·å·¥ä½œ", "è½è€Œä¸å–œæ­¡èªªè©±ï¼Œå§”å©‰æº«å’Œ", "ä¸å‹•æ„Ÿæƒ…ï¼Œè¼ƒå°‘é–’èŠ"] },
        { q: "15. é—œæ–¼åœ˜é«”æ„è­˜ï¼š", o: ["æœ‰ç«¶çˆ­æ‰èƒ½ç™¼æ®æ½›èƒ½", "è¼ƒæ„Ÿæ€§ï¼Œä¸æ³¨æ„ç´°ç¯€", "é †è‘—ç¾¤çœ¾ï¼Œå…·åœ˜é«”æ„è­˜", "å–œæ­¡å»ç ”ç©¶ï¼Œè¬›æ±‚è­‰æ“š"] },
        { q: "16. é—œæ–¼èƒ½åŠ›èˆ‡ç´°ç¯€ï¼š", o: ["å–œæ­¡èƒ½åŠ›èˆ‡æ¬Šå¨", "æƒ…ç·’åŒ–ï¼Œç”Ÿæ°£å¸¸æ°£éé ­", "æŒ‰éƒ¨å°±ç­ï¼Œç©©ç´®ç©©æ‰“", "å¾ˆæ³¨æ„äº‹å‹™èˆ‡äººçš„ç´°ç¯€"] },
        { q: "17. é—œæ–¼æŒæ¡èˆ‡å‚¾å‘ï¼š", o: ["æœ‰å–œæ­¡å»æŒæ¡åŠæ”¯é…ä»–äººå‚¾å‘", "å–œæ­¡æ‰“æˆä¸€ç‰‡ï¼Œæ´»æ½‘æœ‰æ°£æ°›", "éµå®ˆå‚³çµ±æ­¥é©Ÿåšäº‹", "å¯§å¯ä¿æŒç¾ç‹€ç›´åˆ°æŒæ¡äº‹å¯¦"] },
        { q: "18. é—œæ–¼æºé€šç›´æ¥åº¦ï¼š", o: ["ç›´æ¥äº†ç•¶çš„èªªï¼Œä¸å…œåœˆå­", "å–œæ­¡å¹«åŠ©äººï¼Œç›¸è¦ªç›¸æ„›", "è¦ç©©å®šå®‰å…¨çš„ç”Ÿæ´»æ–¹å¼", "è¦æ±‚æº–ç¢ºç„¡èª¤ï¼Œé«˜å“è³ªé«˜æ¨™æº–"] },
        { q: "19. é—œæ–¼æ¨™æº–ç¨‹åºï¼š", o: ["ä¸å–œæ­¡åˆ¥äººé€—æˆ‘é–‹å¿ƒ", "å–œæ­¡åƒåŠ åœ˜é«”æ´»å‹•", "éœéœæœ‰è€å¿ƒçš„åš", "è¦æœ‰è¨ˆåŠƒè¨­è¨ˆçš„ä½œæ¥­ç¨‹åº"] },
        { q: "20. é—œæ–¼è¢«æ”¯é…æ„Ÿï¼š", o: ["è¨å­åˆ¥äººå‘Šè¨´æˆ‘è©²å¦‚ä½•åš", "ç”Ÿæ°£å‹ƒå‹ƒå¤–å‘çš„äºº", "å–œæ­¡ç¨è™•ï¼Œæ³¨æ„ä¸æ‰“æ“¾ä»–äºº", "å¾ˆå°‘åŠ å…¥é–’èŠï¼Œæœƒæ‰¾æ›´å¤šè³‡æ–™"] }
    ];

    let userName = "";
    let currentIdx = 0;
    let scores = { D: 0, I: 0, S: 0, C: 0 };
    let choiceHistory = []; // ç´€éŒ„æ¯é¡Œé¸äº†ä»€éº¼é¡å‹
    let quizActive = false;

    function goToStart() {
        userName = document.getElementById('user-name').value.trim();
        if(!userName) return alert("è«‹è¼¸å…¥æ‚¨çš„å§“å");
        document.getElementById('view-name').style.display = 'none';
        document.getElementById('view-start').style.display = 'block';
        document.getElementById('display-name').innerText = userName;
    }

    function startQuiz() {
        quizActive = true;
        document.getElementById('view-start').style.display = 'none';
        document.getElementById('view-quiz').style.display = 'block';
        renderQuestion();
    }

    function renderQuestion() {
        const q = questions[currentIdx];
        document.getElementById('q-title').innerText = q.q;
        document.getElementById('pb').style.width = ((currentIdx / 20) * 100) + "%";
        document.getElementById('btn-back').style.display = currentIdx > 0 ? "block" : "none";
        
        const box = document.getElementById('options-box');
        box.innerHTML = "";
        const types = ['D', 'I', 'S', 'C'];
        q.o.forEach((txt, i) => {
            const btn = document.createElement('button');
            btn.className = "option-btn";
            btn.innerText = txt;
            btn.onclick = () => {
                const type = types[i];
                scores[type]++;
                choiceHistory.push(type);
                currentIdx++;
                if(currentIdx < 20) renderQuestion(); else showReport();
            };
            box.appendChild(btn);
        });
    }

    function prevQuestion() {
        if (currentIdx > 0) {
            currentIdx--;
            const lastType = choiceHistory.pop();
            scores[lastType]--;
            renderQuestion();
        }
    }

    function showReport() {
        quizActive = false;
        document.getElementById('view-quiz').style.display = 'none';
        document.getElementById('view-report').style.display = 'block';
        
        const sorted = Object.entries(scores).sort((a,b) => b[1] - a[1]);
        const top1 = sorted[0];
        const top2 = sorted[1];
        const top3 = sorted[2];
        const top4 = sorted[3];

        let finalType = "";
        let animal = "";
        let mainDesc = "";

        if (top1[1] - top4[1] <= 1) {
            finalType = "è®Šè‰²é¾";
            animal = "chameleon.png";
            mainDesc = "æ‚¨çš„å„é …æ•¸å€¼éå¸¸å¹³å‡ï¼Œå…·å‚™æ¥µå¼·çš„ç’°å¢ƒé©æ‡‰èƒ½åŠ›ã€‚";
        } else {
            // è‡ªå‹•çµ„åˆä»£è™Ÿ (å¦‚ IDS, ID, D)
            let typeCode = top1[0];
            if (top1[1] - top2[1] <= 3) typeCode += top2[0];
            if (top1[1] - top3[1] <= 3) typeCode += top3[0];
            finalType = typeCode;

            const map = { D: "è€è™", I: "å­”é›€", S: "ç„¡å°¾ç†Š", C: "è²“é ­é·¹" };
            const imgMap = { D: "tiger.png", I: "peacock.png", S: "koala.png", C: "owl.png" };
            const descMap = {
                D: "è€è™ï¼ˆæ”¯é…å‹ï¼‰ï¼šç›®æ¨™å°å‘ã€å…·é ˜å°åŠ›ï¼Œé‡æ•ˆç‡ã€‚",
                I: "å­”é›€ï¼ˆå½±éŸ¿å‹ï¼‰ï¼šç¤¾äº¤æ€§å¼·ã€ç†±æƒ…ï¼Œé‡è¦–äººéš›æ°›åœã€‚",
                S: "ç„¡å°¾ç†Šï¼ˆç©©å¥å‹ï¼‰ï¼šå®‰å®šå¹³ç©©ã€å–„æ–¼å‚¾è½ï¼Œé‡è¦–åœ˜éšŠã€‚",
                C: "è²“é ­é·¹ï¼ˆåˆ†æå‹ï¼‰ï¼šç²¾ç¢ºã€è¬›æ±‚é‚è¼¯ï¼Œå°å“è³ªè¦æ±‚é«˜ã€‚"
            };

            animal = imgMap[top1[0]];
            mainDesc = descMap[top1[0]];
        }

        document.getElementById('report-user-name').innerText = userName + " çš„è¨ºæ–·å ±å‘Š";
        document.getElementById('result-type').innerText = finalType + " å‹äºº";
        document.getElementById('animal-img').src = "images/" + animal;
        document.getElementById('main-desc').innerText = mainDesc;
        document.getElementById('depth-desc').innerText = depthAnalysisLib[finalType] || depthAnalysisLib["default"];

        drawChart();
    }

    function drawChart() {
        new Chart(document.getElementById('discChart'), {
            type: 'bar',
            data: {
                labels: ['D è€è™', 'I å­”é›€', 'S ç„¡å°¾ç†Š', 'C è²“é ­é·¹'],
                datasets: [{
                    data: [scores.D, scores.I, scores.S, scores.C],
                    backgroundColor: ['#FF6B6B', '#FFD93D', '#6BCB77', '#4D96FF']
                }]
            },
            options: { 
                indexAxis: 'y',
                maintainAspectRatio: false,
                plugins: { legend: { display: false } }, 
                scales: { x: { beginAtZero: true, max: 20 } } 
            }
        });
    }

    function downloadImage() {
        html2canvas(document.getElementById('capture-area'), { scale: 2, useCORS: true }).then(canvas => {
            const link = document.createElement('a');
            link.download = `DISC_Report_${userName}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }

    function confirmExit() {
        if (quizActive) {
            if (confirm("æ¸¬é©—æ­£åœ¨é€²è¡Œä¸­ï¼Œç¾åœ¨é›¢é–‹å°‡ä¸æœƒä¿ç•™é€²åº¦ï¼Œç¢ºå®šè¦è¿”å›é¦–é å—ï¼Ÿ")) {
                location.href = "index.html"; 
            }
        } else {
            location.href = "index.html";
        }
    }
</script>
</body>
</html>
